import{r as c,j as e}from"./app-DQczwFTk.js";import{B as m}from"./button-BYXnJyXv.js";import{D as O,b as B,c as H,d as R,e as $,f as q}from"./dialog-DHq7tLZ5.js";import{I as L}from"./input-goWATpHJ.js";import{L as D}from"./label-BchK1h47.js";import{T as V}from"./textarea-DHAakLHN.js";import{C as Z}from"./checkbox-Cvj9wDgC.js";import{A as k}from"./api-DdUbHrO8.js";import{t as d}from"./index-Cou6Ygo0.js";import{C as U,a as G,d as J}from"./card-BNPG6E-E.js";import{A}from"./app-sidebar-layout-DjIGW_b8.js";import{P as M}from"./plus-BGuKkasZ.js";import{S as K}from"./search-DPYN2drD.js";import{c as Q}from"./createLucideIcon-D40S4Mwt.js";import{P as W}from"./pencil-Chy_hZuP.js";import{T as X}from"./trash-2-b2Qe_qpo.js";import"./app-C-su-A41.js";import"./index-D2mu7mBH.js";import"./utils-CPN-yreq.js";import"./index-DcW1-0jE.js";import"./index-BBPPPnEU.js";import"./index-KJ4lOR0W.js";import"./index-CqVE9Fls.js";import"./index-DSuT5VJt.js";import"./index-CnB8Y-kE.js";import"./index-CTC3mW-r.js";import"./index-BVHM8iLO.js";import"./x-CNv1352c.js";import"./index-7Ou4doz_.js";import"./index-ClSqUjUN.js";import"./index-BOxxC3ps.js";import"./index-CX1ZUDb2.js";import"./dropdown-menu-DWIT9g2E.js";import"./index-BfMh8EvQ.js";import"./index-CJpv9kZ5.js";import"./avatar-CLHvFKAC.js";import"./receipt-BIwab1oI.js";import"./file-text-mqHhLRuK.js";import"./folder-BRrK2jGA.js";import"./credit-card-DX0EPogz.js";import"./key-aou-cbKc.js";import"./shield-BhSokjS6.js";import"./dollar-sign-OeXEXPCy.js";import"./app-logo-icon-2MFPo7KO.js";import"./toast-lvG1LsW6.js";/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Y=[["path",{d:"M20 10a1 1 0 0 0 1-1V6a1 1 0 0 0-1-1h-2.5a1 1 0 0 1-.8-.4l-.9-1.2A1 1 0 0 0 15 3h-2a1 1 0 0 0-1 1v5a1 1 0 0 0 1 1Z",key:"hod4my"}],["path",{d:"M20 21a1 1 0 0 0 1-1v-3a1 1 0 0 0-1-1h-2.9a1 1 0 0 1-.88-.55l-.42-.85a1 1 0 0 0-.92-.6H13a1 1 0 0 0-1 1v5a1 1 0 0 0 1 1Z",key:"w4yl2u"}],["path",{d:"M3 5a2 2 0 0 0 2 2h3",key:"f2jnh7"}],["path",{d:"M3 3v13a2 2 0 0 0 2 2h3",key:"k8epm1"}]],P=Q("FolderTree",Y);function ee({isOpen:f,onClose:b,category:t,onSuccess:h}){const u=!!t,[j,v]=c.useState(!1),[p,r]=c.useState({}),[o,x]=c.useState({name:"",description:"",is_active:!0});c.useEffect(()=>{x(t?{name:t.name||"",description:t.description||"",is_active:t.is_active!==void 0?t.is_active:!0}:{name:"",description:"",is_active:!0})},[t,f]);const _=async n=>{var g,y;n.preventDefault(),v(!0),r({});try{let l;u&&t?(l=await k.put(`/v1/categories/${t.id}`,o),l&&(d.success("Categoría actualizada exitosamente"),h&&h(l,!0))):(l=await k.post("/v1/categories",o),l&&(d.success("Categoría creada exitosamente"),h&&h(l,!1))),N()}catch(l){console.error("Error:",l);const C=l;if((y=(g=C.response)==null?void 0:g.data)!=null&&y.errors){r(C.response.data.errors);const w=Object.values(C.response.data.errors)[0];d.error(w||"Error al procesar el formulario")}else d.error("Error al procesar la solicitud")}finally{v(!1)}},N=()=>{x({name:"",description:"",is_active:!0}),r({}),b()};return e.jsx(O,{open:f,onOpenChange:N,children:e.jsxs(B,{className:"sm:max-w-md",children:[e.jsxs(H,{children:[e.jsx(R,{children:u?"Editar Categoría":"Nueva Categoría"}),e.jsx($,{children:u?"Actualice los datos de la categoría.":"Complete la información para crear una nueva categoría."})]}),e.jsxs("form",{onSubmit:_,className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs(D,{htmlFor:"name",children:["Nombre ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(L,{id:"name",value:o.name,onChange:n=>x({...o,name:n.target.value}),placeholder:"Ingrese el nombre de la categoría",className:p.name?"border-red-500":""}),p.name&&e.jsx("p",{className:"text-sm text-red-500",children:p.name})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(D,{htmlFor:"description",children:"Descripción"}),e.jsx(V,{id:"description",value:o.description,onChange:n=>x({...o,description:n.target.value}),placeholder:"Ingrese una descripción (opcional)",className:p.description?"border-red-500":""}),p.description&&e.jsx("p",{className:"text-sm text-red-500",children:p.description})]}),u&&e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Z,{id:"is_active",checked:o.is_active,onCheckedChange:n=>x({...o,is_active:!!n})}),e.jsx(D,{htmlFor:"is_active",className:"text-sm font-normal",children:"Categoría activa"})]}),e.jsxs(q,{children:[e.jsx(m,{type:"button",variant:"outline",onClick:N,disabled:j,children:"Cancelar"}),e.jsxs(m,{type:"submit",disabled:j,children:[u?"Actualizar":"Crear"," Categoría"]})]})]})]})})}function Ue(){const[f,b]=c.useState([]),[t,h]=c.useState({current_page:1,first_page_url:"",from:0,last_page:1,last_page_url:"",links:[],next_page_url:null,path:"",per_page:10,prev_page_url:null,to:0,total:0}),[u,j]=c.useState(!0),[v,p]=c.useState(null),[r,o]=c.useState({search:"",is_active:null,sort_field:"name",sort_order:"asc",per_page:10}),[x,_]=c.useState(!1),[N,n]=c.useState(void 0);c.useEffect(()=>{g()},[r]);const g=async()=>{try{j(!0);const a={...r,is_active:r.is_active===null?"":r.is_active?"true":"false"},i=await k.get("/v1/categories",{params:a}),{categories:s}=i.data;b(s.data||[]),h({current_page:s.current_page,first_page_url:s.first_page_url,from:s.from||0,last_page:s.last_page,last_page_url:s.last_page_url,links:s.links,next_page_url:s.next_page_url,path:s.path,per_page:s.per_page,prev_page_url:s.prev_page_url,to:s.to||0,total:s.total})}catch(a){console.error("Error al cargar categorías:",a),p("Error al cargar las categorías"),d.error("Error al cargar las categorías")}finally{j(!1)}},y=a=>{a.preventDefault(),g()},l=a=>{o(i=>({...i,sort_field:a,sort_order:i.sort_field===a&&i.sort_order==="asc"?"desc":"asc"}))},C=async(a,i)=>{if(i>0){d.error("No se puede eliminar esta categoría porque tiene productos asociados");return}if(confirm("¿Está seguro de eliminar esta categoría?"))try{await k.delete(`/v1/categories/${a}`),b(s=>s.filter(S=>S.id!==a)),d.success("Categoría eliminada exitosamente")}catch(s){console.error("Error al eliminar la categoría:",s),d.error("Error al eliminar la categoría")}},w=a=>{if(!a)return;const s=new URL(a).searchParams.get("page");s&&o(S=>({...S,page:parseInt(s)}))},E=()=>{n(void 0),_(!0)},T=a=>{n(a),_(!0)},I=()=>{n(void 0),_(!1)},z=async(a,i=!1)=>{try{await g(),i?d.success("Categoría actualizada exitosamente"):d.success("Categoría creada exitosamente")}catch(s){console.error("Error al recargar categorías:",s),d.error("Operación exitosa, pero hubo un error al actualizar la lista")}I()},F=[{title:"Inicio",href:"/"},{title:"Categorías",href:"/categories"}];return v?e.jsx(A,{breadcrumbs:F,children:e.jsx("div",{className:"p-4 text-center text-red-500",children:v})}):e.jsxs(A,{breadcrumbs:F,children:[e.jsxs("div",{className:"flex flex-1 flex-col gap-4 p-4 md:gap-8 md:p-8",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Categorías"}),e.jsxs(m,{onClick:E,children:[e.jsx(M,{className:"mr-2 h-4 w-4"}),"Nueva Categoría"]})]}),e.jsxs(U,{children:[e.jsx(G,{className:"pb-3",children:e.jsxs("form",{onSubmit:y,className:"flex flex-wrap items-center gap-2",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(K,{className:"absolute top-2.5 left-2.5 h-4 w-4 text-muted-foreground"}),e.jsx(L,{type:"search",placeholder:"Buscar categorías...",className:"w-full appearance-none bg-background pl-8 shadow-none md:w-2/3 lg:w-1/3",value:r.search||"",onChange:a=>o(i=>({...i,search:a.target.value}))})]}),e.jsxs("select",{className:"h-10 rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background",value:r.is_active===null?"":r.is_active?"true":"false",onChange:a=>{const i=a.target.value;o(s=>({...s,is_active:i===""?null:i==="true"}))},children:[e.jsx("option",{value:"",children:"Todos los estados"}),e.jsx("option",{value:"true",children:"Activos"}),e.jsx("option",{value:"false",children:"Inactivos"})]}),e.jsx(m,{type:"submit",variant:"secondary",children:"Buscar"})]})}),e.jsx(J,{children:e.jsxs("div",{className:"rounded-md border",children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-muted/50 text-left text-xs font-medium text-muted-foreground",children:[e.jsxs("th",{className:"cursor-pointer px-4 py-3",onClick:()=>l("id"),children:["ID",r.sort_field==="id"&&e.jsx("span",{className:"ml-1",children:r.sort_order==="asc"?"↑":"↓"})]}),e.jsxs("th",{className:"cursor-pointer px-4 py-3",onClick:()=>l("name"),children:["Nombre",r.sort_field==="name"&&e.jsx("span",{className:"ml-1",children:r.sort_order==="asc"?"↑":"↓"})]}),e.jsx("th",{className:"px-4 py-3",children:"Descripción"}),e.jsxs("th",{className:"cursor-pointer px-4 py-3",onClick:()=>l("products_count"),children:["Productos",r.sort_field==="products_count"&&e.jsx("span",{className:"ml-1",children:r.sort_order==="asc"?"↑":"↓"})]}),e.jsxs("th",{className:"cursor-pointer px-4 py-3",onClick:()=>l("is_active"),children:["Estado",r.sort_field==="is_active"&&e.jsx("span",{className:"ml-1",children:r.sort_order==="asc"?"↑":"↓"})]}),e.jsx("th",{className:"px-4 py-3 text-right",children:"Acciones"})]})}),e.jsx("tbody",{children:u?e.jsx("tr",{children:e.jsx("td",{colSpan:6,className:"px-4 py-4 text-center",children:e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx("div",{className:"h-8 w-8 animate-spin rounded-full border-4 border-primary border-t-transparent"})})})}):f.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:6,className:"px-4 py-4",children:e.jsxs("div",{className:"flex flex-col items-center justify-center py-8 text-center",children:[e.jsx(P,{className:"h-12 w-12 text-gray-400"}),t.total===0?e.jsxs(e.Fragment,{children:[e.jsx("h3",{className:"mt-2 text-sm font-medium text-gray-900 dark:text-gray-100",children:"No hay categorías registradas"}),e.jsx("p",{className:"mt-1 text-sm text-gray-500 dark:text-gray-400",children:"Para comenzar a usar el sistema, necesitas registrar al menos una categoría."}),e.jsx("div",{className:"mt-6",children:e.jsxs(m,{onClick:E,children:[e.jsx(M,{className:"mr-2 h-4 w-4"}),"Registrar Primera Categoría"]})})]}):e.jsxs(e.Fragment,{children:[e.jsx("h3",{className:"mt-2 text-sm font-medium text-gray-900 dark:text-gray-100",children:"No se encontraron resultados"}),e.jsx("p",{className:"mt-1 text-sm text-gray-500 dark:text-gray-400",children:"No hay categorías que coincidan con los filtros aplicados."}),e.jsxs("div",{className:"mt-6 flex flex-col gap-2 sm:flex-row",children:[e.jsx(m,{variant:"outline",onClick:()=>o({search:"",is_active:null,sort_field:"name",sort_order:"asc",per_page:10}),children:"Limpiar filtros"}),e.jsxs(m,{onClick:E,children:[e.jsx(M,{className:"mr-2 h-4 w-4"}),"Nueva Categoría"]})]})]})]})})}):f.map(a=>e.jsxs("tr",{className:"border-t",children:[e.jsx("td",{className:"px-4 py-3",children:a.id}),e.jsxs("td",{className:"flex items-center gap-2 px-4 py-3",children:[e.jsx(P,{className:"h-5 w-5 text-muted-foreground"}),a.name]}),e.jsx("td",{className:"px-4 py-3",children:a.description||"-"}),e.jsx("td",{className:"px-4 py-3",children:e.jsx("span",{className:"inline-flex items-center rounded-full bg-blue-100 px-2.5 py-0.5 text-xs font-medium text-blue-800 dark:bg-blue-800/20 dark:text-blue-400",children:a.products_count||0})}),e.jsx("td",{className:"px-4 py-3",children:e.jsx("span",{className:`inline-flex items-center rounded-full px-2.5 py-0.5 text-xs font-medium ${a.is_active?"bg-green-100 text-green-800 dark:bg-green-800/20 dark:text-green-400":"bg-red-100 text-red-800 dark:bg-red-800/20 dark:text-red-400"}`,children:a.is_active?"Activo":"Inactivo"})}),e.jsx("td",{className:"px-4 py-3 text-right",children:e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsxs(m,{variant:"ghost",size:"icon",onClick:()=>T(a),children:[e.jsx(W,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"Editar"})]}),e.jsxs(m,{variant:"ghost",size:"icon",className:"text-red-500",onClick:()=>C(a.id,a.products_count||0),children:[e.jsx(X,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"Eliminar"})]})]})})]},a.id))})]})}),t.last_page>1&&e.jsxs("div",{className:"flex items-center justify-between border-t px-4 py-4",children:[e.jsxs("div",{className:"text-sm text-muted-foreground",children:["Mostrando ",t.from," a ",t.to," de ",t.total," resultados"]}),e.jsx("div",{className:"flex gap-1",children:t.links&&t.links.map((a,i)=>e.jsx(m,{variant:a.active?"default":"outline",size:"sm",disabled:!a.url,onClick:()=>a.url&&w(a.url),dangerouslySetInnerHTML:{__html:a.label}},i))})]})]})})]})]}),e.jsx(ee,{isOpen:x,onClose:I,category:N,onSuccess:z})]})}export{Ue as default};
