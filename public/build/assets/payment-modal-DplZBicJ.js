import{r as i,j as a}from"./app-DQczwFTk.js";import{D as y,b as j,c as v,d as C,e as E}from"./dialog-DHq7tLZ5.js";import{A as q}from"./api-DdUbHrO8.js";import{L as _}from"./loader-circle-0WVi89tk.js";const b=s=>({card_declined:"La tarjeta fue rechazada. Por favor, intente con otra tarjeta.",expired_card:"La tarjeta está vencida.",insufficient_funds:"La tarjeta no tiene fondos suficientes.",invalid_card:"La tarjeta es inválida.",contact_issuer:"Contacte al emisor de su tarjeta.",invalid_number:"El número de tarjeta es inválido.",invalid_expiry_month:"El mes de expiración es inválido.",invalid_expiry_year:"El año de expiración es inválido.",invalid_cvc:"El código de seguridad es inválido.",processing_error:"Ocurrió un error procesando su pago. Por favor, intente nuevamente."})[s]||"Error al procesar el pago. Por favor, intente nuevamente.";function L({isOpen:s,onClose:c,amount:o,planId:l,billingPeriod:d,onPaymentSuccess:u,onPaymentError:t}){const[p,m]=i.useState(!1),[n,w]=i.useState(!1),g=r=>{console.error("Error processing payment:",r);const e=r instanceof Error?r.message:String(r),f=typeof r=="object"&&r!==null?r.code:"",h=f?b(f):e||"Error al procesar el pago";t(new Error(h))};i.useEffect(()=>s?((async()=>{try{const e=document.createElement("script");e.src="https://checkout.culqi.com/js/v4",e.async=!0,e.onload=()=>{window.Culqi.publicKey=void 0,w(!0)},document.body.appendChild(e)}catch(e){console.error("Error loading Culqi script:",e),t(new Error("Error al cargar el script de Culqi"))}})(),()=>{const e=document.querySelector('script[src="https://checkout.culqi.com/js/v4"]');e&&document.body.removeChild(e)}):void 0,[s,t]);const x=i.useCallback(()=>{n&&(window.Culqi.settings({title:"Suscripción",currency:"PEN",amount:o*100,order:"pgo_test_ID_DE_ORDEN",language:"es"}),window.Culqi.options({style:{logo:"/logo.svg",maincolor:"#6366F1",buttontext:"white",maintext:"#4F46E5",desctext:"#6B7280"}}),window.Culqi.open(),window.culqi=async()=>{if(window.Culqi.token)try{m(!0);const r={token:window.Culqi.token.id,email:window.Culqi.token.email,amount:o,currency_code:"PEN",plan_id:l,billing_period:d},e=await q.post("/payment/process",r);if(!e.success||!e.data)throw new Error(e.message||"Error al procesar el pago");u(e.data.payment_id)}catch(r){g(r)}finally{m(!1)}else window.Culqi.error&&g(window.Culqi.error)})},[n,o,l,d,u]);return a.jsx(y,{open:s,onOpenChange:c,children:a.jsxs(j,{className:"sm:max-w-[500px]",children:[a.jsxs(v,{children:[a.jsx(C,{children:"Suscripción al Plan"}),a.jsx(E,{children:"Complete los datos de su tarjeta para procesar la suscripción"})]}),a.jsx("div",{className:"relative min-h-[100px] w-full",children:a.jsx("div",{className:"flex flex-col items-center justify-center gap-4",children:a.jsx("button",{onClick:x,disabled:p||!n,className:"w-full rounded-md bg-indigo-600 px-4 py-2 text-white hover:bg-indigo-700 disabled:opacity-50",children:p?a.jsxs("div",{className:"flex items-center justify-center gap-2",children:[a.jsx(_,{className:"h-5 w-5 animate-spin"}),a.jsx("span",{children:"Procesando..."})]}):"Pagar con Tarjeta"})})})]})})}export{L as P};
