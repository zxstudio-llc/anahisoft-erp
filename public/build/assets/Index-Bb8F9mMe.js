import{r as c,j as e,H as R}from"./app-DQczwFTk.js";import{B as d}from"./button-BYXnJyXv.js";import{D as H,b as O,c as V,d as B,e as $,f as G}from"./dialog-DHq7tLZ5.js";import{I as N}from"./input-goWATpHJ.js";import{L as j}from"./label-BchK1h47.js";import{S as k,a as S,b as E,c as F,d as p}from"./select-D52pRjk-.js";import{C as J}from"./checkbox-Cvj9wDgC.js";import{A as U}from"./api-DdUbHrO8.js";import{t as u}from"./index-Cou6Ygo0.js";import{C as K,a as Q,d as W}from"./card-BNPG6E-E.js";import{A as X}from"./app-layout-CxNCz1W0.js";import{C as I}from"./circle-user-BmLeNbtb.js";import{P as C}from"./plus-BGuKkasZ.js";import{S as Y}from"./search-DPYN2drD.js";import{P as Z}from"./pencil-Chy_hZuP.js";import{T as ee}from"./trash-2-b2Qe_qpo.js";import"./app-C-su-A41.js";import"./index-D2mu7mBH.js";import"./utils-CPN-yreq.js";import"./index-DcW1-0jE.js";import"./index-BBPPPnEU.js";import"./index-KJ4lOR0W.js";import"./index-CqVE9Fls.js";import"./index-DSuT5VJt.js";import"./index-CnB8Y-kE.js";import"./index-CTC3mW-r.js";import"./index-BVHM8iLO.js";import"./x-CNv1352c.js";import"./createLucideIcon-D40S4Mwt.js";import"./index-BfMh8EvQ.js";import"./index-BOxxC3ps.js";import"./index-ClSqUjUN.js";import"./index-7Ou4doz_.js";import"./index-CX1ZUDb2.js";import"./chevron-down-Bqmppv4h.js";import"./tenant-status-listener-Bzjk6yNz.js";import"./toast-lvG1LsW6.js";import"./app-sidebar-layout-DjIGW_b8.js";import"./dropdown-menu-DWIT9g2E.js";import"./index-CJpv9kZ5.js";import"./avatar-CLHvFKAC.js";import"./receipt-BIwab1oI.js";import"./file-text-mqHhLRuK.js";import"./folder-BRrK2jGA.js";import"./credit-card-DX0EPogz.js";import"./key-aou-cbKc.js";import"./shield-BhSokjS6.js";import"./dollar-sign-OeXEXPCy.js";import"./app-logo-icon-2MFPo7KO.js";import"./cookie-consent-DYpW6VIi.js";function se({isOpen:f,onClose:h,user:t,roles:b,onSuccess:i}){const[l,n]=c.useState({name:"",email:"",password:"",password_confirmation:"",role:"",is_active:!0}),[y,g]=c.useState(!1);c.useEffect(()=>{var r,o;n(t?{name:t.name,email:t.email,password:"",password_confirmation:"",role:((o=(r=t.roles)==null?void 0:r[0])==null?void 0:o.name)||"",is_active:t.is_active}:{name:"",email:"",password:"",password_confirmation:"",role:"",is_active:!0})},[t]);const _=async r=>{var o,w;r.preventDefault(),g(!0);try{const m=t?`/v1/users/${t.id}`:"/v1/users",x=t?"put":"post";if(l.role==="default"){u.error("Por favor selecciona un rol válido"),g(!1);return}const v=await U[x](m,{...l,role:l.role});v.data.success&&(u.success(v.data.message),i(v.data.data),h())}catch(m){const x=m;console.error("Error al guardar usuario:",m),u.error(((w=(o=x.response)==null?void 0:o.data)==null?void 0:w.message)||"Error al guardar el usuario")}finally{g(!1)}};return e.jsx(H,{open:f,onOpenChange:h,children:e.jsxs(O,{children:[e.jsxs(V,{children:[e.jsx(B,{children:t?"Editar Usuario":"Crear Usuario"}),e.jsx($,{children:t?"Actualiza los datos del usuario":"Ingresa los datos del nuevo usuario"})]}),e.jsxs("form",{onSubmit:_,className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(j,{htmlFor:"name",children:"Nombre"}),e.jsx(N,{id:"name",value:l.name,onChange:r=>n({...l,name:r.target.value}),required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(j,{htmlFor:"email",children:"Email"}),e.jsx(N,{id:"email",type:"email",value:l.email,onChange:r=>n({...l,email:r.target.value}),required:!0})]}),!t&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(j,{htmlFor:"password",children:"Contraseña"}),e.jsx(N,{id:"password",type:"password",value:l.password,onChange:r=>n({...l,password:r.target.value}),required:!t})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(j,{htmlFor:"password_confirmation",children:"Confirmar Contraseña"}),e.jsx(N,{id:"password_confirmation",type:"password",value:l.password_confirmation,onChange:r=>n({...l,password_confirmation:r.target.value}),required:!t})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(j,{htmlFor:"role",children:"Rol"}),e.jsxs(k,{value:l.role||"default",onValueChange:r=>n({...l,role:r==="default"?"":r}),required:!0,children:[e.jsx(S,{children:e.jsx(E,{placeholder:"Selecciona un rol"})}),e.jsxs(F,{children:[e.jsx(p,{value:"default",disabled:!0,children:"Selecciona un rol"}),b.map(r=>e.jsx(p,{value:r.value,children:r.label},r.value))]})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(J,{id:"is_active",checked:l.is_active,onCheckedChange:r=>n({...l,is_active:r})}),e.jsx(j,{htmlFor:"is_active",children:"Usuario activo"})]}),e.jsxs(G,{children:[e.jsx(d,{type:"button",variant:"outline",onClick:h,children:"Cancelar"}),e.jsx(d,{type:"submit",disabled:y,children:y?"Guardando...":t?"Actualizar":"Crear"})]})]})]})})}function Ye(){const[f,h]=c.useState([]),[t,b]=c.useState({current_page:1,from:0,last_page:1,links:[],path:"",per_page:10,to:0,total:0}),[i,l]=c.useState({search:"",role:"",is_active:null,sort_field:"created_at",sort_order:"desc",per_page:10}),[n,y]=c.useState([]),[g,_]=c.useState(!1),[r,o]=c.useState(!1),[w,m]=c.useState(void 0),x=c.useCallback(async()=>{try{_(!0);const s=await U.get("/v1/users",{params:i});s.data.success&&(h(s.data.users.data),b({current_page:s.data.users.current_page,from:s.data.users.from,last_page:s.data.users.last_page,links:s.data.users.links,path:s.data.users.path,per_page:s.data.users.per_page,to:s.data.users.to,total:s.data.users.total}),y(s.data.roles))}catch(s){console.error("Error al cargar usuarios:",s),u.error("Error al cargar los usuarios")}finally{_(!1)}},[i]);c.useEffect(()=>{x()},[x]);const v=s=>{l(a=>({...a,search:s,page:1}))},A=s=>{l(a=>({...a,role:s==="all"?"":s,page:1}))},L=s=>{l(a=>({...a,is_active:s==="all"?null:s==="active",page:1}))},D=s=>{l(a=>({...a,sort_field:s,sort_order:a.sort_field===s&&a.sort_order==="asc"?"desc":"asc",page:1}))},P=s=>{l(a=>({...a,page:s}))},M=s=>{m(s),o(!0)},T=async s=>{if(confirm("¿Está seguro de eliminar este usuario?"))try{const a=await U.delete(`/v1/users/${s.id}`);a.data.success&&(u.success(a.data.message),x())}catch(a){console.error("Error al eliminar usuario:",a),u.error("Error al eliminar el usuario")}},q=async s=>{s?(h(f.map(a=>a.id===s.id?s:a)),u.success("Usuario actualizado exitosamente")):await x(),o(!1),m(void 0)},z=[{title:"Usuarios",href:"/users"}];return e.jsxs(X,{breadcrumbs:z,children:[e.jsx(R,{title:"Usuarios"}),e.jsx("div",{className:"flex h-full flex-1 flex-col gap-4 overflow-x-auto rounded-xl p-4",children:e.jsxs(K,{children:[e.jsxs(Q,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(I,{className:"h-6 w-6"}),e.jsx("h2",{className:"text-2xl font-bold tracking-tight",children:"Usuarios"})]}),e.jsxs(d,{onClick:()=>o(!0),children:[e.jsx(C,{className:"mr-2 h-4 w-4"}),"Nuevo Usuario"]})]}),e.jsxs(W,{children:[e.jsxs("div",{className:"mb-6 flex flex-col gap-4 md:flex-row",children:[e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"relative",children:[e.jsx(Y,{className:"absolute top-2.5 left-2 h-4 w-4 text-muted-foreground"}),e.jsx(N,{placeholder:"Buscar usuarios...",value:i.search,onChange:s=>v(s.target.value),className:"pl-8"})]})}),e.jsxs(k,{value:i.role||"all",onValueChange:A,children:[e.jsx(S,{className:"w-[180px]",children:e.jsx(E,{placeholder:"Filtrar por rol"})}),e.jsxs(F,{children:[e.jsx(p,{value:"all",children:"Todos los roles"}),n.map(s=>e.jsx(p,{value:s.value,children:s.label},s.value))]})]}),e.jsxs(k,{value:i.is_active===null?"all":i.is_active?"active":"inactive",onValueChange:L,children:[e.jsx(S,{className:"w-[180px]",children:e.jsx(E,{placeholder:"Filtrar por estado"})}),e.jsxs(F,{children:[e.jsx(p,{value:"all",children:"Todos los estados"}),e.jsx(p,{value:"active",children:"Activos"}),e.jsx(p,{value:"inactive",children:"Inactivos"})]})]})]}),e.jsx("div",{className:"relative overflow-x-auto",children:g?e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx("div",{className:"h-8 w-8 animate-spin rounded-full border-4 border-primary border-t-transparent"})}):f.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center py-8 text-center",children:[e.jsx(I,{className:"h-12 w-12 text-gray-400"}),t.total===0?e.jsxs(e.Fragment,{children:[e.jsx("h3",{className:"mt-2 text-sm font-medium text-gray-900 dark:text-gray-100",children:"No hay usuarios registrados"}),e.jsx("p",{className:"mt-1 text-sm text-gray-500 dark:text-gray-400",children:"Para comenzar a usar el sistema, necesitas crear al menos un usuario."}),e.jsx("div",{className:"mt-6",children:e.jsxs(d,{onClick:()=>o(!0),children:[e.jsx(C,{className:"mr-2 h-4 w-4"}),"Registrar Primer Usuario"]})})]}):e.jsxs(e.Fragment,{children:[e.jsx("h3",{className:"mt-2 text-sm font-medium text-gray-900 dark:text-gray-100",children:"No se encontraron resultados"}),e.jsx("p",{className:"mt-1 text-sm text-gray-500 dark:text-gray-400",children:"No hay usuarios que coincidan con los filtros aplicados."}),e.jsxs("div",{className:"mt-6 flex flex-col gap-2 sm:flex-row",children:[e.jsx(d,{variant:"outline",onClick:()=>l({search:"",role:"",is_active:null,sort_field:"created_at",sort_order:"desc",per_page:10}),children:"Limpiar filtros"}),e.jsxs(d,{onClick:()=>o(!0),children:[e.jsx(C,{className:"mr-2 h-4 w-4"}),"Nuevo Usuario"]})]})]})]}):e.jsxs("table",{className:"w-full text-left text-sm text-gray-500 dark:text-gray-400",children:[e.jsx("thead",{className:"bg-gray-50 text-xs text-gray-700 uppercase dark:bg-gray-700 dark:text-gray-400",children:e.jsxs("tr",{children:[e.jsxs("th",{scope:"col",className:"cursor-pointer px-6 py-3",onClick:()=>D("name"),children:["Nombre",i.sort_field==="name"&&e.jsx("span",{className:"ml-1",children:i.sort_order==="asc"?"↑":"↓"})]}),e.jsxs("th",{scope:"col",className:"cursor-pointer px-6 py-3",onClick:()=>D("email"),children:["Email",i.sort_field==="email"&&e.jsx("span",{className:"ml-1",children:i.sort_order==="asc"?"↑":"↓"})]}),e.jsx("th",{scope:"col",className:"px-6 py-3",children:"Rol"}),e.jsx("th",{scope:"col",className:"px-6 py-3",children:"Estado"}),e.jsx("th",{scope:"col",className:"px-6 py-3",children:"Acciones"})]})}),e.jsx("tbody",{children:f.map(s=>{var a;return e.jsxs("tr",{className:"border-b bg-white dark:border-gray-700 dark:bg-gray-800",children:[e.jsx("td",{className:"px-6 py-4 font-medium whitespace-nowrap text-gray-900 dark:text-white",children:s.name}),e.jsx("td",{className:"px-6 py-4",children:s.email}),e.jsx("td",{className:"px-6 py-4",children:(a=s.roles[0])==null?void 0:a.name}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("span",{className:`rounded px-2 py-1 text-xs font-medium ${s.is_active?"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-300":"bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-300"}`,children:s.is_active?"Activo":"Inactivo"})}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(d,{variant:"outline",size:"icon",onClick:()=>M(s),children:e.jsx(Z,{className:"h-4 w-4"})}),e.jsx(d,{variant:"outline",size:"icon",onClick:()=>T(s),children:e.jsx(ee,{className:"h-4 w-4"})})]})})]},s.id)})})]})}),t.last_page>1&&e.jsxs("div",{className:"mt-4 flex items-center justify-between",children:[e.jsxs("div",{className:"text-sm text-gray-700 dark:text-gray-400",children:["Mostrando ",e.jsx("span",{className:"font-medium",children:t.from})," a ",e.jsx("span",{className:"font-medium",children:t.to})," de"," ",e.jsx("span",{className:"font-medium",children:t.total})," resultados"]}),e.jsx("div",{className:"flex items-center space-x-2",children:t.links.map((s,a)=>e.jsx(d,{variant:s.active?"default":"outline",disabled:!s.url,onClick:()=>s.url&&P(a),children:e.jsx("span",{dangerouslySetInnerHTML:{__html:s.label}})},a))})]})]})]})}),e.jsx(se,{isOpen:r,onClose:()=>{o(!1),m(void 0)},user:w,roles:n,onSuccess:q})]})}export{Ye as default};
