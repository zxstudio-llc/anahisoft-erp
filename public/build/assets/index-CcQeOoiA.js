import{r as o,j as e,H as ae,b as M,a as u}from"./app-DQczwFTk.js";import{A as te}from"./app-layout-CxNCz1W0.js";import re from"./show-CxgbUnKg.js";import{C as f,a as j,b as g,d as v,e as ie}from"./card-BNPG6E-E.js";import{I as R}from"./input-goWATpHJ.js";import{C as G}from"./checkbox-Cvj9wDgC.js";import{B as y}from"./button-BYXnJyXv.js";import{L as E}from"./label-BchK1h47.js";import{S as V,a as z,b as B,c as K,d as H}from"./select-D52pRjk-.js";import{L as D}from"./loader-circle-0WVi89tk.js";import"./app-C-su-A41.js";import"./tenant-status-listener-Bzjk6yNz.js";import"./index-Cou6Ygo0.js";import"./index-CTC3mW-r.js";import"./toast-lvG1LsW6.js";import"./app-sidebar-layout-DjIGW_b8.js";import"./index-D2mu7mBH.js";import"./utils-CPN-yreq.js";import"./index-DcW1-0jE.js";import"./index-BBPPPnEU.js";import"./index-KJ4lOR0W.js";import"./index-CqVE9Fls.js";import"./index-DSuT5VJt.js";import"./index-CnB8Y-kE.js";import"./index-BVHM8iLO.js";import"./x-CNv1352c.js";import"./createLucideIcon-D40S4Mwt.js";import"./index-BOxxC3ps.js";import"./index-ClSqUjUN.js";import"./index-CX1ZUDb2.js";import"./dropdown-menu-DWIT9g2E.js";import"./index-BfMh8EvQ.js";import"./index-CJpv9kZ5.js";import"./avatar-CLHvFKAC.js";import"./receipt-BIwab1oI.js";import"./file-text-mqHhLRuK.js";import"./folder-BRrK2jGA.js";import"./credit-card-DX0EPogz.js";import"./key-aou-cbKc.js";import"./shield-BhSokjS6.js";import"./dollar-sign-OeXEXPCy.js";import"./search-DPYN2drD.js";import"./app-logo-icon-2MFPo7KO.js";import"./cookie-consent-DYpW6VIi.js";import"./dialog-DHq7tLZ5.js";import"./badge-CIPxAGrn.js";import"./switch-x9PZ-zT7.js";import"./index-7Ou4doz_.js";import"./separator-Dm1V7ums.js";import"./chevron-down-Bqmppv4h.js";function rs({menus:m=[],availablePages:L=[],availableCategories:A=[],menuItemTypes:U={}}){const[t,N]=o.useState(null),[x,P]=o.useState([]),[h,$]=o.useState([]),[i,w]=o.useState({label:"",url:"",target:"_self"}),[b,I]=o.useState(""),[C,F]=o.useState(m),[k,_]=o.useState(!1),[q,O]=o.useState(!1),[le,ne]=o.useState(0),J=[{title:"Panel",href:"/admin"},{title:"Menús",href:"/admin/menus"}];o.useEffect(()=>{m.length>0&&!t&&N(m[0].id)},[m]);const S=async s=>{if(s)try{O(!0);const a=await M.get(`/admin/menus/${s}/items`),r=m.map(d=>d.id===s?{...d,items:a.data.items||[]}:d);u.reload({only:["menus"],data:{menus:r},onSuccess:()=>{N(s)}})}catch(a){console.error("Error loading menu items:",a)}finally{O(!1)}};o.useEffect(()=>{if(t){const s=C.find(a=>a.id===t);s&&!s.items&&S(t)}},[t]);const Q=s=>{confirm("¿Estás seguro de eliminar este menú?")&&u.delete(`/admin/menus/${s}`,{onSuccess:()=>{F(a=>a.filter(r=>r.id!==s)),t===s&&N(null)}})},W=async()=>{if(b.trim())try{_(!0);const s=await M.post("/admin/menus",{title:b,description:"",location:"",is_active:!0});u.reload({only:["menus"],onSuccess:()=>{const a=m.find(r=>r.title===b);a&&N(a.id),I("")}})}catch{alert("Error al crear el menú. Por favor intente nuevamente.")}finally{_(!1)}},X=async()=>{var s;if(t&&x.length>0)try{const a=C.find(l=>l.id===t),r=((s=a==null?void 0:a.items)==null?void 0:s.reduce((l,p)=>Math.max(l,p.order),0))||0,d=x.map(async(l,p)=>{const n=L.find(T=>T.id===l);return M.post(`/admin/menus/${t}/items`,{label:(n==null?void 0:n.title)||"",url:`/${(n==null?void 0:n.slug)||""}`,type:"page",target:"_self",css_class:"",order:r+p+1,parent_id:null,is_active:!0})});await Promise.all(d),await S(t),P([])}catch{alert("Error al agregar páginas. Por favor intente nuevamente.")}},Y=async()=>{var s;if(t&&h.length>0)try{const a=C.find(l=>l.id===t),r=((s=a==null?void 0:a.items)==null?void 0:s.reduce((l,p)=>Math.max(l,p.order),0))||0,d=h.map(async(l,p)=>{const n=A.find(T=>T.id===l);return M.post(`/admin/menus/${t}/items`,{label:(n==null?void 0:n.name)||"",url:`/category/${(n==null?void 0:n.slug)||""}`,type:"category",target:"_self",css_class:"",order:r+p+1,parent_id:null,is_active:!0})});await Promise.all(d),await S(t),$([])}catch{alert("Error al agregar categorías. Por favor intente nuevamente.")}},Z=async()=>{var s;if(t&&i.label&&i.url)try{const a=C.find(d=>d.id===t),r=((s=a==null?void 0:a.items)==null?void 0:s.reduce((d,l)=>Math.max(d,l.order),0))||0;await M.post(`/admin/menus/${t}/items`,{label:i.label,url:i.url,type:"custom",target:i.target,css_class:"",order:r+1,parent_id:null,is_active:!0}),await S(t),w({label:"",url:"",target:"_self"})}catch{alert("Error al agregar enlace personalizado. Por favor intente nuevamente.")}},ee=async(s,a)=>{try{await u.put(`/admin/menus/${s}/update-order`,{items:a},{preserveScroll:!0,onSuccess:()=>{S(s)}})}catch{}},se=async()=>{if(!t)return;const s=C.find(a=>a.id===t);if(s)try{_(!0),await u.put(`/admin/menus/${t}`,{title:s.title,description:s.description,location:s.location,is_active:s.is_active},{onSuccess:()=>{u.reload()}})}catch{alert("Error al guardar el menú. Por favor intente nuevamente.")}finally{_(!1)}},c=t?m.find(s=>s.id===t):null;return e.jsxs(te,{breadcrumbs:J,children:[e.jsx(ae,{title:"Gestión de Menús"}),e.jsxs("div",{className:"hidden h-full flex-1 flex-col space-y-8 p-8 md:flex",children:[e.jsx("div",{className:"flex items-center justify-between space-y-2",children:e.jsx("div",{children:e.jsx("h2",{className:"text-2xl font-bold tracking-tight",children:"Menus"})})}),e.jsx("div",{className:"space-y-6",children:e.jsxs("div",{className:"flex gap-6",children:[e.jsx("div",{className:"w-full lg:w-1/4 space-y-4",children:e.jsxs(f,{children:[e.jsx(j,{children:e.jsx(g,{className:"text-base",children:"Agregar elementos al menú"})}),e.jsxs(v,{className:"space-y-6",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx(E,{children:"Seleccionar menú para editar"}),e.jsxs(V,{value:(t==null?void 0:t.toString())||"",onValueChange:s=>N(s?parseInt(s):null),children:[e.jsx(z,{children:e.jsx(B,{placeholder:"-- Seleccione un menú --"})}),e.jsx(K,{children:m.map(s=>{var a;return e.jsxs(H,{value:s.id.toString(),children:[s.title," (",((a=s.items)==null?void 0:a.length)||0," items)"]},s.id)})})]})]}),e.jsxs(f,{className:"border",children:[e.jsx(j,{children:e.jsx(g,{className:"text-sm",children:"Crear nuevo menú"})}),e.jsxs(v,{className:"flex flex-col gap-2",children:[e.jsx(R,{value:b,onChange:s=>I(s.target.value),placeholder:"Nombre del menú"}),e.jsx(y,{onClick:W,disabled:!b.trim()||k,children:k?"Creando...":"Crear"})]})]}),L.length>0&&e.jsxs(f,{children:[e.jsx(j,{children:e.jsx(g,{className:"text-sm",children:"Páginas"})}),e.jsx(v,{className:"px-4 py-2 space-y-2 max-h-48 overflow-y-auto",children:L.map(s=>e.jsxs("label",{className:"flex items-center space-x-2 text-sm",children:[e.jsx("input",{type:"checkbox",checked:x.includes(s.id),onChange:a=>a.target.checked?P([...x,s.id]):P(x.filter(r=>r!==s.id)),disabled:!t}),e.jsx("span",{children:s.title})]},s.id))}),e.jsx("div",{className:"px-4 py-2 border-t",children:e.jsx(y,{onClick:X,disabled:x.length===0||!t,className:"w-full",children:"Añadir al menú"})})]}),A.length>0&&e.jsxs(f,{children:[e.jsx(j,{children:e.jsx(g,{className:"text-sm",children:"Categorías"})}),e.jsx(v,{className:"px-4 py-2 space-y-2 max-h-48 overflow-y-auto",children:A.map(s=>e.jsxs("label",{className:"flex items-center space-x-2 text-sm",children:[e.jsx("input",{type:"checkbox",checked:h.includes(s.id),onChange:a=>a.target.checked?$([...h,s.id]):$(h.filter(r=>r!==s.id)),disabled:!t}),e.jsx("span",{children:s.name})]},s.id))}),e.jsx("div",{className:"px-4 py-2 border-t",children:e.jsx(y,{onClick:Y,disabled:h.length===0||!t,className:"w-full bg-green-600 hover:bg-green-700",children:"Añadir al menú"})})]}),e.jsxs(f,{children:[e.jsx(j,{children:e.jsx(g,{className:"text-sm",children:"Enlaces personalizados"})}),e.jsxs(v,{className:"px-4 py-2 space-y-2",children:[e.jsx(R,{type:"text",value:i.url,onChange:s=>w({...i,url:s.target.value}),placeholder:"URL",disabled:!t}),e.jsx(R,{type:"text",value:i.label,onChange:s=>w({...i,label:s.target.value}),placeholder:"Texto del enlace",disabled:!t}),e.jsxs(V,{value:i.target,onValueChange:s=>w({...i,target:s}),disabled:!t,children:[e.jsx(z,{children:e.jsx(B,{})}),e.jsxs(K,{children:[e.jsx(H,{value:"_self",children:"Misma ventana"}),e.jsx(H,{value:"_blank",children:"Nueva ventana"})]})]}),e.jsx(y,{onClick:Z,disabled:!i.label||!i.url||!t,className:"w-full bg-purple-600 hover:bg-purple-700",children:"Añadir al menú"})]})]})]})]})}),e.jsx("div",{className:"w-3/4 h-full",children:e.jsxs(f,{className:"w-full",children:[e.jsx(j,{children:e.jsx(g,{className:"text-xl",children:"Estructura del Menú"})}),e.jsxs(v,{className:"space-y-2",children:[q?e.jsxs("div",{className:"flex items-center justify-center py-8",children:[e.jsx(D,{className:"h-8 w-8 animate-spin"}),e.jsx("span",{className:"ml-2",children:"Cargando elementos del menú..."})]}):c?e.jsx("div",{className:"rounded-md border border-transparent",children:e.jsx(re,{items:c.items||[],menuTitle:c.title,menuId:c.id,menuItemTypes:U,onReorder:s=>ee(c.id,s)})}):e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:"Selecciona un menú para ver su estructura"}),c&&e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold mb-2",children:"Configuraciones del Menú"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(G,{id:"auto-add-pages"}),e.jsx(E,{htmlFor:"auto-add-pages",children:"Agregar automáticamente nuevas páginas principales a este menú"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(G,{id:"primary",checked:c.location==="primary",onCheckedChange:s=>{F(a=>a.map(r=>r.id===c.id?{...r,location:s?"primary":""}:r))}}),e.jsx(E,{htmlFor:"primary",children:"Menú principal"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(G,{id:"secondary",checked:c.location==="secondary",onCheckedChange:s=>{F(a=>a.map(r=>r.id===c.id?{...r,location:s?"secondary":""}:r))}}),e.jsx(E,{htmlFor:"secondary",children:"Menú secundario"})]})]})]})]})]}),e.jsx(ie,{className:"flex justify-between items-center",children:c&&e.jsxs(e.Fragment,{children:[e.jsx(y,{variant:"destructive",onClick:()=>Q(c.id),children:"Eliminar Menú"}),e.jsx(y,{onClick:se,disabled:k,children:k?e.jsxs(e.Fragment,{children:[e.jsx(D,{className:"mr-2 h-4 w-4 animate-spin"}),"Guardando..."]}):"Guardar Menú"})]})})]})})]})})]})]})}export{rs as default};
