import{r as p,u as D,j as e,H as L}from"./app-DQczwFTk.js";import{B as f}from"./badge-CIPxAGrn.js";import{B as I}from"./button-BYXnJyXv.js";import{C as l,a as o,b as c,c as x,d as h,e as H}from"./card-BNPG6E-E.js";import{A as O}from"./app-layout-CxNCz1W0.js";import{L as j}from"./label-BchK1h47.js";import{R as A,a as g}from"./radio-group-nj5wdHV6.js";import{t as E}from"./index-Cou6Ygo0.js";import{C as z}from"./index-ClSqUjUN.js";import{T as G}from"./triangle-alert-dUu2CXl0.js";import"./app-C-su-A41.js";import"./index-D2mu7mBH.js";import"./utils-CPN-yreq.js";import"./tenant-status-listener-Bzjk6yNz.js";import"./toast-lvG1LsW6.js";import"./app-sidebar-layout-DjIGW_b8.js";import"./index-DcW1-0jE.js";import"./index-BBPPPnEU.js";import"./index-KJ4lOR0W.js";import"./index-CqVE9Fls.js";import"./index-DSuT5VJt.js";import"./index-CnB8Y-kE.js";import"./index-CTC3mW-r.js";import"./index-BVHM8iLO.js";import"./x-CNv1352c.js";import"./createLucideIcon-D40S4Mwt.js";import"./index-BOxxC3ps.js";import"./index-CX1ZUDb2.js";import"./dropdown-menu-DWIT9g2E.js";import"./index-BfMh8EvQ.js";import"./index-CJpv9kZ5.js";import"./avatar-CLHvFKAC.js";import"./receipt-BIwab1oI.js";import"./file-text-mqHhLRuK.js";import"./folder-BRrK2jGA.js";import"./credit-card-DX0EPogz.js";import"./key-aou-cbKc.js";import"./shield-BhSokjS6.js";import"./dollar-sign-OeXEXPCy.js";import"./search-DPYN2drD.js";import"./app-logo-icon-2MFPo7KO.js";import"./cookie-consent-DYpW6VIi.js";import"./index-7Ou4doz_.js";function Be({currentPlan:d,availablePlans:t=[],subscriptionStatus:n}){var w,C,P;const[y,S]=p.useState("monthly"),[N,F]=p.useState(null),[V,T]=p.useState(null),{data:s,setData:b,post:k,processing:v,errors:_}=D({plan_id:(d==null?void 0:d.id)||"",payment_method:"credit_card",billing_period:"monthly"});p.useEffect(()=>{const r=document.createElement("script");return r.src="https://sdk.mercadopago.com/js/v2",r.async=!0,r.onload=()=>{const i=new window.MercadoPago(void 0);F(i)},document.body.appendChild(r),()=>{document.body.removeChild(r)}},[]);const $=r=>{b("plan_id",r)},B=async()=>{try{const i=await(await fetch("/payment/create-preference",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({plan_id:s.plan_id,billing_period:s.billing_period})})).json();if(!i.success)throw new Error(i.message);return i.preference_id}catch(r){return console.error("Error creating preference:",r),E.error("Error al procesar el pago. Por favor intente nuevamente."),null}},M=async r=>{r.preventDefault();const i=t.find(a=>a.id===Number(s.plan_id));if(!i){E.error("Por favor seleccione un plan");return}if(i.price>0){const a=await B();if(!a)return;T(a),N&&N.checkout({preference:{id:a},render:{container:"#payment-form",label:"Pagar"}});return}k("/subscription/process-payment")},R=(r,i)=>{if(i==="yearly"){const a=r*12,u=a*.15;return a-u}return r},m=(r,i)=>`${R(r,i).toLocaleString("es-PE",{style:"currency",currency:"PEN"})}/${i==="monthly"?"mes":"año"}`;return e.jsxs(O,{children:[e.jsx(L,{title:"Actualizar Suscripción"}),e.jsxs("div",{className:"flex h-full flex-1 flex-col gap-4 overflow-x-auto rounded-xl p-4",children:[e.jsx("h1",{className:"mb-6 text-2xl font-bold",children:"Actualizar Suscripción"}),(n==null?void 0:n.onTrial)&&n.trialEndsAt&&e.jsx("div",{className:"mb-6 rounded-md bg-blue-50 p-4 dark:bg-blue-950/20",children:e.jsxs("p",{className:"text-sm text-blue-700 dark:text-blue-400",children:["Estás en periodo de prueba. Termina en ",new Date(n.trialEndsAt).toLocaleDateString("es-ES")]})}),e.jsxs("div",{className:"grid grid-cols-1 gap-6 md:grid-cols-3",children:[e.jsxs("div",{className:"md:col-span-2",children:[e.jsxs(l,{children:[e.jsxs(o,{children:[e.jsx(c,{children:"Opciones de Facturación"}),e.jsx(x,{children:"Primero, seleccione su periodo de facturación preferido"})]}),e.jsx(h,{children:e.jsxs(A,{value:s.billing_period,onValueChange:r=>{b("billing_period",r),S(r)},className:"grid grid-cols-2 gap-4",children:[e.jsx("div",{className:`flex items-center justify-between rounded-md border p-4 ${s.billing_period==="monthly"?"border-primary bg-primary/5":"border-border"}`,children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(g,{value:"monthly",id:"monthly"}),e.jsxs("div",{children:[e.jsx(j,{htmlFor:"monthly",className:"text-base font-medium",children:"Mensual"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Facturación cada mes"})]})]})}),e.jsxs("div",{className:`flex items-center justify-between rounded-md border p-4 ${s.billing_period==="yearly"?"border-primary bg-primary/5":"border-border"}`,children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(g,{value:"yearly",id:"yearly"}),e.jsxs("div",{children:[e.jsx(j,{htmlFor:"yearly",className:"text-base font-medium",children:"Anual"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Facturación cada año"})]})]}),e.jsx(f,{variant:"outline",className:"border-green-200 bg-green-50 text-green-700",children:"Ahorro 15%"})]})]})})]}),Array.isArray(t)&&t.length>0?e.jsxs(l,{className:"mt-6",children:[e.jsxs(o,{children:[e.jsx(c,{children:"Seleccione un Plan"}),e.jsx(x,{children:s.billing_period==="yearly"?"Planes anuales con 15% de descuento":"Planes con facturación mensual"})]}),e.jsx(h,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsx(A,{value:String(s.plan_id),onValueChange:r=>$(Number(r)),children:t.map(r=>{var i;return e.jsxs("div",{className:`flex items-center justify-between rounded-md border p-4 ${s.plan_id===r.id?"border-primary bg-primary/5":"border-border"}`,children:[e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(g,{value:String(r.id),id:`plan-${r.id}`}),e.jsxs("div",{children:[e.jsxs(j,{htmlFor:`plan-${r.id}`,className:"flex items-center text-base font-medium",children:[r.name,r.is_featured&&e.jsx(f,{className:"ml-2",children:"Recomendado"}),(d==null?void 0:d.id)===r.id&&e.jsx(f,{variant:"outline",className:"ml-2",children:"Plan Actual"})]}),e.jsx("p",{className:"mt-1 text-sm text-muted-foreground",children:r.invoice_limit===0?"Facturas ilimitadas":`${r.invoice_limit} facturas/mes`}),e.jsx("ul",{className:"mt-2 space-y-1",children:(i=r.features)==null?void 0:i.map((a,u)=>e.jsxs("li",{className:"flex items-center text-sm",children:[e.jsx(z,{className:"mr-2 h-3 w-3 text-primary"}),a]},u))})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"font-medium",children:m(r.price,y)}),y==="yearly"&&e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Precio mensual: ",m(r.price,"monthly")]})]})]},r.id)})}),_.plan_id&&e.jsx("div",{className:"text-sm text-red-500",children:_.plan_id})]})})]}):e.jsx(l,{children:e.jsxs(o,{children:[e.jsx(c,{children:"No hay planes disponibles"}),e.jsx(x,{children:"Por favor, intente más tarde o contacte con el administrador."})]})}),e.jsxs(l,{className:"mt-6",children:[e.jsxs(o,{children:[e.jsx(c,{children:"Método de Pago"}),e.jsx(x,{children:"Seleccione su método de pago preferido"})]}),e.jsx(h,{children:e.jsx("div",{id:"payment-form",className:"w-full"})})]})]}),e.jsx("div",{children:e.jsxs(l,{className:"sticky top-6",children:[e.jsx(o,{children:e.jsx(c,{children:"Resumen de la Suscripción"})}),e.jsx(h,{className:"space-y-4",children:s.plan_id?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Plan:"}),e.jsx("span",{className:"font-medium",children:((w=t.find(r=>r.id===Number(s.plan_id)))==null?void 0:w.name)||"Plan seleccionado"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Periodo:"}),e.jsx("span",{className:"font-medium",children:s.billing_period==="monthly"?"Mensual":"Anual"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Método de pago:"}),e.jsx("span",{className:"font-medium",children:s.payment_method==="credit_card"?"Tarjeta":"Transferencia"})]}),e.jsxs("div",{className:"mt-4 border-t pt-4",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"font-medium",children:"Total a pagar:"}),e.jsxs("div",{className:"text-right",children:[e.jsx("span",{className:"font-bold",children:m(((C=t.find(r=>r.id===Number(s.plan_id)))==null?void 0:C.price)||0,s.billing_period)}),s.billing_period==="yearly"&&e.jsx("p",{className:"text-xs text-green-600",children:"Ahorro del 15% aplicado"})]})]}),s.billing_period==="yearly"&&e.jsxs("p",{className:"mt-2 text-xs text-muted-foreground",children:["Equivalente a ",m((((P=t.find(r=>r.id===Number(s.plan_id)))==null?void 0:P.price)||0)*.85,"monthly")," por mes"]})]})]}):e.jsxs("div",{className:"flex items-center rounded-md bg-amber-50 p-4 dark:bg-amber-950/20",children:[e.jsx(G,{className:"mr-2 h-5 w-5 text-amber-500"}),e.jsx("p",{className:"text-sm",children:"Por favor, seleccione un plan para continuar."})]})}),e.jsx(H,{children:e.jsx(I,{className:"w-full",onClick:M,disabled:!s.plan_id||v,children:v?"Procesando...":"Confirmar y Pagar"})})]})})]})]})]})}export{Be as default};
