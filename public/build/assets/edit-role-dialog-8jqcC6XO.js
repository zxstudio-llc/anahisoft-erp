import{r as g,b as O,j as o,a as B}from"./app-DQczwFTk.js";import{B as F}from"./button-BYXnJyXv.js";import{D as I,b as L,c as Z,d as H}from"./dialog-DHq7tLZ5.js";import{g as _,s as y,h as R,u as T,F as q,a as b,b as E,c as v,d as N,e as P}from"./form-9z_uuQ6M.js";import{p as J,a as K,$ as Q,o as W,c as X,n as Y,s as k}from"./schemas-BDuxrwph.js";import{I as D}from"./input-goWATpHJ.js";import{C as ee}from"./checkbox-Cvj9wDgC.js";import{t as w}from"./index-Cou6Ygo0.js";import"./app-C-su-A41.js";import"./index-D2mu7mBH.js";import"./utils-CPN-yreq.js";import"./index-DcW1-0jE.js";import"./index-BBPPPnEU.js";import"./index-KJ4lOR0W.js";import"./index-CqVE9Fls.js";import"./index-DSuT5VJt.js";import"./index-CnB8Y-kE.js";import"./index-CTC3mW-r.js";import"./index-BVHM8iLO.js";import"./x-CNv1352c.js";import"./createLucideIcon-D40S4Mwt.js";import"./label-BchK1h47.js";import"./index-7Ou4doz_.js";import"./index-ClSqUjUN.js";const G=(s,n,r)=>{if(s&&"reportValidity"in s){const e=_(r,n);s.setCustomValidity(e&&e.message||""),s.reportValidity()}},C=(s,n)=>{for(const r in n.fields){const e=n.fields[r];e&&e.ref&&"reportValidity"in e.ref?G(e.ref,r,s):e&&e.refs&&e.refs.forEach(t=>G(t,r,s))}},$=(s,n)=>{n.shouldUseNativeValidation&&C(s,n);const r={};for(const e in s){const t=_(n.fields,e),i=Object.assign(s[e]||{},{ref:t&&t.ref});if(re(n.names||Object.keys(s),e)){const a=Object.assign({},_(r,e));y(a,"root",i),y(r,e,a)}else y(r,e,i)}return r},re=(s,n)=>{const r=z(n);return s.some(e=>z(e).match(`^${r}\\.\\d+`))};function z(s){return s.replace(/\]|\[/g,"")}function A(s,n){try{var r=s()}catch(e){return n(e)}return r&&r.then?r.then(void 0,n):r}function se(s,n){for(var r={};s.length;){var e=s[0],t=e.code,i=e.message,a=e.path.join(".");if(!r[a])if("unionErrors"in e){var l=e.unionErrors[0].errors[0];r[a]={message:l.message,type:l.code}}else r[a]={message:i,type:t};if("unionErrors"in e&&e.unionErrors.forEach(function(x){return x.errors.forEach(function(h){return s.push(h)})}),n){var d=r[a].types,u=d&&d[e.code];r[a]=R(a,n,r,t,u?[].concat(u,e.message):e.message)}s.shift()}return r}function oe(s,n){for(var r={};s.length;){var e=s[0],t=e.code,i=e.message,a=e.path.join(".");if(!r[a])if(e.code==="invalid_union"&&e.errors.length>0){var l=e.errors[0][0];r[a]={message:l.message,type:l.code}}else r[a]={message:i,type:t};if(e.code==="invalid_union"&&e.errors.forEach(function(x){return x.forEach(function(h){return s.push(h)})}),n){var d=r[a].types,u=d&&d[e.code];r[a]=R(a,n,r,t,u?[].concat(u,e.message):e.message)}s.shift()}return r}function ae(s,n,r){if(r===void 0&&(r={}),function(e){return"_def"in e&&typeof e._def=="object"&&"typeName"in e._def}(s))return function(e,t,i){try{return Promise.resolve(A(function(){return Promise.resolve(s[r.mode==="sync"?"parse":"parseAsync"](e,n)).then(function(a){return i.shouldUseNativeValidation&&C({},i),{errors:{},values:r.raw?Object.assign({},e):a}})},function(a){if(function(l){return Array.isArray(l==null?void 0:l.issues)}(a))return{values:{},errors:$(se(a.errors,!i.shouldUseNativeValidation&&i.criteriaMode==="all"),i)};throw a}))}catch(a){return Promise.reject(a)}};if(function(e){return"_zod"in e&&typeof e._zod=="object"}(s))return function(e,t,i){try{return Promise.resolve(A(function(){return Promise.resolve((r.mode==="sync"?J:K)(s,e,n)).then(function(a){return i.shouldUseNativeValidation&&C({},i),{errors:{},values:r.raw?Object.assign({},e):a}})},function(a){if(function(l){return l instanceof Q}(a))return{values:{},errors:$(oe(a.issues,!i.shouldUseNativeValidation&&i.criteriaMode==="all"),i)};throw a}))}catch(a){return Promise.reject(a)}};throw new Error("Invalid input: not a Zod schema")}const ne=W({name:k().min(2,{message:"El nombre debe tener al menos 2 caracteres"}),guard_name:k().optional().default("web"),permissions:X(Y())});function ke({roleId:s,open:n,onOpenChange:r,onSuccess:e}){const[t,i]=g.useState(!0),[a,l]=g.useState([]),[d,u]=g.useState(null),[x,h]=g.useState(["web"]),p=T({resolver:ae(ne),defaultValues:{name:"",guard_name:"web",permissions:[]}});g.useEffect(()=>{n&&s&&(i(!0),O.get(`/admin/roles/${s}/edit`).then(c=>{const{role:m,permissions:f,guards:j}=c.data;u(m),l(f),h(j||["web"]),p.reset({name:m.name,guard_name:m.guard_name,permissions:m.permissions})}).catch(c=>{w.error("Error al cargar el rol"),console.error(c)}).finally(()=>i(!1)))},[n,s]);const S=c=>{B.put(`/admin/roles/${s}`,{name:c.name,guard_name:c.guard_name,permissions:c.permissions},{onSuccess:()=>{w.success("Rol actualizado correctamente"),r(!1),e==null||e()},onError:m=>{w.error("Error al actualizar el rol"),console.error(m)}})};return o.jsx(I,{open:n,onOpenChange:r,children:o.jsxs(L,{className:"sm:max-w-[800px] max-h-[80vh] overflow-y-auto",children:[o.jsx(Z,{children:o.jsx(H,{children:t?"Cargando...":`Editar Rol: ${d==null?void 0:d.name}`})}),t?o.jsx("div",{className:"flex justify-center py-8",children:o.jsx("p",{children:"Cargando informaciÃ³n del rol..."})}):o.jsx(q,{...p,children:o.jsxs("form",{onSubmit:p.handleSubmit(S),className:"space-y-6",children:[o.jsxs("div",{className:"flex gap-4",children:[o.jsx(b,{control:p.control,name:"name",render:({field:c})=>o.jsxs(E,{children:[o.jsx(v,{children:"Nombre del Rol"}),o.jsx(N,{children:o.jsx(D,{...c})}),o.jsx(P,{})]})}),o.jsx(b,{control:p.control,name:"guard_name",render:({field:c})=>o.jsxs(E,{children:[o.jsx(v,{children:"Guard"}),o.jsx(N,{children:o.jsx(D,{...c,type:"text",disabled:!0,className:"block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm bg-gray-100 text-gray-500 cursor-not-allowed focus:outline-none"})}),o.jsx(P,{})]})})]}),o.jsxs("div",{children:[o.jsx(v,{children:"Permisos"}),o.jsx("div",{className:"space-y-4 mt-4",children:a.map(c=>o.jsxs("div",{className:"border rounded-lg p-4",children:[o.jsx("h3",{className:"font-medium mb-3 capitalize",children:c.group}),o.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3",children:c.permissions.map(m=>o.jsx(b,{control:p.control,name:"permissions",render:({field:f})=>{var j;return o.jsxs(E,{className:"flex items-center space-x-2 space-y-0",children:[o.jsx(N,{children:o.jsx(ee,{checked:(j=f.value)==null?void 0:j.includes(m.id),onCheckedChange:U=>{var V;return U?f.onChange([...f.value,m.id]):f.onChange((V=f.value)==null?void 0:V.filter(M=>M!==m.id))}})}),o.jsx(v,{className:"font-normal",children:m.description})]})}},`permission-${m.id}`))})]},c.group))})]}),o.jsxs("div",{className:"flex justify-end gap-2",children:[o.jsx(F,{type:"button",variant:"outline",onClick:()=>r(!1),children:"Cancelar"}),o.jsx(F,{type:"submit",disabled:t,children:"Guardar Cambios"})]})]})})]})})}export{ke as EditRoleDialog};
