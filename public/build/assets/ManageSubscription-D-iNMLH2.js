import{r as j,j as e,a as P,b as A,H as se,L as G}from"./app-DQczwFTk.js";import{B as d}from"./button-BYXnJyXv.js";import{C as M,a as H,b as V,c as O,d as $}from"./card-BNPG6E-E.js";import{B as l}from"./badge-CIPxAGrn.js";import{D as J,a as K,b as Q,c as W,d as X,e as Y,f as Z}from"./dialog-DHq7tLZ5.js";import{I}from"./input-goWATpHJ.js";import{L as n}from"./label-BchK1h47.js";import{S as C,a as D,b as w,c as F,d as x}from"./select-D52pRjk-.js";import{T as ie,a as ae,b as L,c as _,d as re,e as h}from"./table-J6M9UKS6.js";import{t as v}from"./index-Cou6Ygo0.js";import{P as te}from"./plus-BGuKkasZ.js";import{D as le}from"./dollar-sign-OeXEXPCy.js";import{A as ne}from"./app-layout-CxNCz1W0.js";import{A as ce}from"./arrow-left-BLAf5pk1.js";import{C as U}from"./calendar-RZLbZmV6.js";import"./app-C-su-A41.js";import"./index-D2mu7mBH.js";import"./utils-CPN-yreq.js";import"./index-DcW1-0jE.js";import"./index-BBPPPnEU.js";import"./index-KJ4lOR0W.js";import"./index-CqVE9Fls.js";import"./index-DSuT5VJt.js";import"./index-CnB8Y-kE.js";import"./index-CTC3mW-r.js";import"./index-BVHM8iLO.js";import"./x-CNv1352c.js";import"./createLucideIcon-D40S4Mwt.js";import"./index-BfMh8EvQ.js";import"./index-BOxxC3ps.js";import"./index-ClSqUjUN.js";import"./index-7Ou4doz_.js";import"./index-CX1ZUDb2.js";import"./chevron-down-Bqmppv4h.js";import"./tenant-status-listener-Bzjk6yNz.js";import"./toast-lvG1LsW6.js";import"./app-sidebar-layout-DjIGW_b8.js";import"./dropdown-menu-DWIT9g2E.js";import"./index-CJpv9kZ5.js";import"./avatar-CLHvFKAC.js";import"./receipt-BIwab1oI.js";import"./file-text-mqHhLRuK.js";import"./folder-BRrK2jGA.js";import"./credit-card-DX0EPogz.js";import"./key-aou-cbKc.js";import"./shield-BhSokjS6.js";import"./search-DPYN2drD.js";import"./app-logo-icon-2MFPo7KO.js";import"./cookie-consent-DYpW6VIi.js";function de({tenant:i,payments:f=[],subscriptionPlans:E,paymentMethods:k}){const[N,o]=j.useState(!1),[c,m]=j.useState({tenant_id:i.id,subscription_plan_id:i.subscription_plan?i.subscription_plan.id.toString():"",payment_method:"bank_transfer",amount:"",payment_date:new Date().toISOString().split("T")[0],billing_period:"monthly",status:"completed",notes:""}),[a,y]=j.useState({}),[S,q]=j.useState(!1),p=s=>{const{name:r,value:t}=s.target;m(u=>({...u,[r]:t}))},b=(s,r)=>{m(t=>({...t,[s]:r}))},z=async s=>{var r,t;s.preventDefault(),q(!0),y({});try{await A.post(route("payments.store"),c),o(!1),v.success("Pago registrado correctamente"),P.reload()}catch(u){if(A.isAxiosError(u)){const g=u;(t=(r=g.response)==null?void 0:r.data)!=null&&t.errors&&y(g.response.data.errors)}v.error("Error al registrar el pago")}finally{q(!1)}},B=s=>{switch(s){case"completed":return e.jsx(l,{className:"bg-green-500",children:"Completado"});case"pending":return e.jsx(l,{className:"bg-yellow-500",children:"Pendiente"});case"failed":return e.jsx(l,{className:"bg-red-500",children:"Fallido"});case"refunded":return e.jsx(l,{className:"bg-blue-500",children:"Reembolsado"});default:return e.jsx(l,{children:s})}},T=s=>s?new Date(s).toLocaleDateString():"N/A",R=async()=>{try{const s=await A.post(route("admin.tenants.toggle-active",i.id));v.success(s.data.message),P.reload()}catch{v.error("Error al cambiar el estado del inquilino")}};return e.jsxs(M,{className:"mt-6",children:[e.jsxs(H,{className:"flex flex-row items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(V,{children:"Historial de Pagos"}),e.jsx(O,{children:"Historial de pagos realizados por este inquilino."})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(d,{variant:i.is_active?"destructive":"default",onClick:R,children:i.is_active?"Bloquear Inquilino":"Activar Inquilino"}),e.jsxs(J,{open:N,onOpenChange:o,children:[e.jsx(K,{asChild:!0,children:e.jsxs(d,{children:[e.jsx(te,{className:"mr-2 h-4 w-4"}),"Registrar Pago"]})}),e.jsx(Q,{className:"sm:max-w-[550px]",children:e.jsxs("form",{onSubmit:z,children:[e.jsxs(W,{children:[e.jsx(X,{children:"Registrar Nuevo Pago"}),e.jsx(Y,{children:"Complete los detalles del pago para registrarlo en el sistema."})]}),e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"subscription_plan_id",children:"Plan de Suscripción"}),e.jsxs(C,{name:"subscription_plan_id",value:c.subscription_plan_id,onValueChange:s=>b("subscription_plan_id",s),required:!0,children:[e.jsx(D,{children:e.jsx(w,{placeholder:"Seleccione un plan"})}),e.jsx(F,{children:E.map(s=>e.jsxs(x,{value:s.id.toString(),children:[s.name," - $",s.price]},s.id))})]}),a.subscription_plan_id&&e.jsx("p",{className:"text-red-500 text-sm",children:a.subscription_plan_id})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"amount",children:"Monto"}),e.jsx(I,{id:"amount",name:"amount",type:"number",step:"0.01",value:c.amount,onChange:p,required:!0}),a.amount&&e.jsx("p",{className:"text-red-500 text-sm",children:a.amount})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"payment_date",children:"Fecha de Pago"}),e.jsx(I,{id:"payment_date",name:"payment_date",type:"date",value:c.payment_date,onChange:p,required:!0}),a.payment_date&&e.jsx("p",{className:"text-red-500 text-sm",children:a.payment_date})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"payment_method",children:"Método de Pago"}),e.jsxs(C,{name:"payment_method",value:c.payment_method,onValueChange:s=>b("payment_method",s),required:!0,children:[e.jsx(D,{children:e.jsx(w,{placeholder:"Seleccione un método"})}),e.jsx(F,{children:k.map(s=>e.jsx(x,{value:s.value,children:s.label},s.value))})]}),a.payment_method&&e.jsx("p",{className:"text-red-500 text-sm",children:a.payment_method})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"billing_period",children:"Período de Facturación"}),e.jsxs(C,{name:"billing_period",value:c.billing_period,onValueChange:s=>b("billing_period",s),required:!0,children:[e.jsx(D,{children:e.jsx(w,{placeholder:"Seleccione un período"})}),e.jsxs(F,{children:[e.jsx(x,{value:"monthly",children:"Mensual"}),e.jsx(x,{value:"yearly",children:"Anual"})]})]}),a.billing_period&&e.jsx("p",{className:"text-red-500 text-sm",children:a.billing_period})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"status",children:"Estado"}),e.jsxs(C,{name:"status",value:c.status,onValueChange:s=>b("status",s),required:!0,children:[e.jsx(D,{children:e.jsx(w,{placeholder:"Seleccione un estado"})}),e.jsxs(F,{children:[e.jsx(x,{value:"completed",children:"Completado"}),e.jsx(x,{value:"pending",children:"Pendiente"}),e.jsx(x,{value:"failed",children:"Fallido"}),e.jsx(x,{value:"refunded",children:"Reembolsado"})]})]}),a.status&&e.jsx("p",{className:"text-red-500 text-sm",children:a.status})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"notes",children:"Notas"}),e.jsx(I,{id:"notes",name:"notes",value:c.notes,onChange:p,placeholder:"Notas adicionales sobre el pago"}),a.notes&&e.jsx("p",{className:"text-red-500 text-sm",children:a.notes})]})]}),e.jsxs(Z,{children:[e.jsx(d,{type:"button",variant:"outline",onClick:()=>o(!1),children:"Cancelar"}),e.jsx(d,{type:"submit",disabled:S,children:S?"Registrando...":"Registrar Pago"})]})]})})]})]})]}),e.jsx($,{children:e.jsx("div",{className:"rounded-md border",children:e.jsxs(ie,{children:[e.jsx(ae,{children:e.jsxs(L,{children:[e.jsx(_,{children:"ID"}),e.jsx(_,{children:"Plan"}),e.jsx(_,{children:"Monto"}),e.jsx(_,{children:"Fecha de Pago"}),e.jsx(_,{children:"Período"}),e.jsx(_,{children:"Estado"}),e.jsx(_,{children:"Acciones"})]})}),e.jsx(re,{children:f.length===0?e.jsx(L,{children:e.jsx(h,{colSpan:7,className:"text-center py-8",children:e.jsxs("div",{className:"flex flex-col items-center justify-center",children:[e.jsx(le,{className:"h-12 w-12 text-gray-300 mb-2"}),e.jsx("p",{className:"text-lg font-medium",children:"No hay pagos registrados"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Registre un nuevo pago para comenzar"})]})})}):f.map(s=>e.jsxs(L,{children:[e.jsx(h,{children:s.id}),e.jsx(h,{children:s.subscription_plan.name}),e.jsxs(h,{children:["$",typeof s.amount=="number"?s.amount.toFixed(2):parseFloat(s.amount).toFixed(2)]}),e.jsx(h,{children:T(s.payment_date)}),e.jsx(h,{children:s.billing_period==="monthly"?"Mensual":"Anual"}),e.jsx(h,{children:B(s.status)}),e.jsx(h,{children:e.jsx(d,{variant:"outline",size:"sm",onClick:()=>P.visit(route("payments.show",s.id)),children:"Ver"})})]},s.id))})]})})})]})}function ts({tenant:i,subscriptionPlans:f,payments:E}){const[k,N]=j.useState(!1),[o,c]=j.useState({subscription_plan_id:i.subscription_plan?i.subscription_plan.id:"",trial_ends_at:i.trial_ends_at?new Date(i.trial_ends_at).toISOString().split("T")[0]:"",subscription_active:i.subscription_active,subscription_ends_at:i.subscription_ends_at?new Date(i.subscription_ends_at).toISOString().split("T")[0]:"",is_active:i.is_active}),[m,a]=j.useState({}),[y,S]=j.useState(!1),q=[{title:"Dashboard",href:route("dashboard")},{title:"Inquilinos",href:route("admin.tenants.index")},{title:"Gestionar Suscripción",href:route("admin.tenants.subscription",i.id)}],p=s=>{const{name:r,value:t,type:u,checked:g}=s.target;c(ee=>({...ee,[r]:u==="checkbox"?g:t}))},b=(s,r)=>{c(t=>({...t,[s]:r}))},z=async s=>{var r,t;s.preventDefault(),S(!0),a({});try{await A.post(route("admin.tenants.subscription.update",i.id),o),N(!1),v.success("Suscripción actualizada correctamente"),P.reload()}catch(u){if(A.isAxiosError(u)){const g=u;(t=(r=g.response)==null?void 0:r.data)!=null&&t.errors&&a(g.response.data.errors)}v.error("Error al actualizar la suscripción")}finally{S(!1)}},B=s=>{switch(s){case"active":return e.jsx(l,{className:"bg-green-500",children:"Activo"});case"trial":return e.jsx(l,{className:"bg-blue-500",children:"Prueba"});case"expired":return e.jsx(l,{className:"bg-red-500",children:"Expirado"});case"inactive":return e.jsx(l,{className:"bg-gray-500",children:"Inactivo"});default:return e.jsx(l,{children:s})}},T=s=>s?new Date(s).toLocaleDateString():"N/A",R=[{value:"credit_card",label:"Tarjeta de Crédito"},{value:"bank_transfer",label:"Transferencia Bancaria"},{value:"paypal",label:"PayPal"},{value:"cash",label:"Efectivo"},{value:"other",label:"Otro"}];return e.jsxs(ne,{breadcrumbs:q,children:[e.jsx(se,{title:`Gestionar Suscripción - ${i.company_name}`}),e.jsxs("div",{className:"flex h-full flex-1 flex-col gap-4 overflow-x-auto rounded-xl p-4",children:[e.jsxs("div",{className:"mb-6 flex items-center gap-4",children:[e.jsx(G,{href:route("admin.tenants.index"),children:e.jsx(d,{variant:"outline",size:"icon",children:e.jsx(ce,{className:"h-4 w-4"})})}),e.jsx("h1",{className:"text-3xl font-bold",children:"Gestionar Suscripción"})]}),e.jsxs("div",{className:"grid grid-cols-1 gap-6 md:grid-cols-3",children:[e.jsxs("div",{className:"md:col-span-2",children:[e.jsxs(M,{children:[e.jsxs(H,{children:[e.jsx(V,{children:"Información del Inquilino"}),e.jsx(O,{children:"Detalles del inquilino y su suscripción actual."})]}),e.jsx($,{children:e.jsxs("div",{className:"grid grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-500",children:"ID del Inquilino"}),e.jsx("p",{className:"mt-1 text-lg font-medium",children:i.id})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-500",children:"Nombre de la Empresa"}),e.jsx("p",{className:"mt-1 text-lg font-medium",children:i.company_name})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-500",children:"Dominio Principal"}),e.jsx("p",{className:"mt-1 text-lg font-medium",children:e.jsx("a",{href:`https://${i.primary_domain}`,target:"_blank",className:"text-blue-600 hover:underline",children:i.primary_domain})})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-500",children:"Estado"}),e.jsxs("div",{className:"mt-1 flex items-center gap-2",children:[i.is_active?e.jsx(l,{className:"bg-green-500",children:"Activo"}):e.jsx(l,{className:"bg-red-500",children:"Bloqueado"}),B(i.subscription_status)]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-500",children:"Plan Actual"}),e.jsx("p",{className:"mt-1 text-lg font-medium",children:i.subscription_plan?i.subscription_plan.name:"Sin plan asignado"})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-500",children:"Fin del Período de Prueba"}),e.jsx("p",{className:"mt-1 text-lg font-medium",children:T(i.trial_ends_at)})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-500",children:"Fin de la Suscripción"}),e.jsx("p",{className:"mt-1 text-lg font-medium",children:T(i.subscription_ends_at)})]})]})})]}),e.jsx(de,{tenant:{...i,domains_count:0,created_at:new Date().toISOString(),subscription_plan:i.subscription_plan?{...i.subscription_plan,id:i.subscription_plan.id.toString()}:void 0},payments:E,subscriptionPlans:f,paymentMethods:R})]}),e.jsx("div",{children:e.jsxs(M,{children:[e.jsxs(H,{children:[e.jsx(V,{children:"Actualizar Suscripción"}),e.jsx(O,{children:"Modifique los detalles de la suscripción del inquilino."})]}),e.jsxs($,{children:[e.jsxs(J,{open:k,onOpenChange:N,children:[e.jsx(K,{asChild:!0,children:e.jsx(d,{className:"mb-4 w-full",children:"Actualizar Suscripción"})}),e.jsx(Q,{className:"sm:max-w-[550px]",children:e.jsxs("form",{onSubmit:z,children:[e.jsxs(W,{children:[e.jsx(X,{children:"Actualizar Suscripción"}),e.jsx(Y,{children:"Modifique los detalles de la suscripción para este inquilino."})]}),e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"subscription_plan_id",children:"Plan de Suscripción"}),e.jsxs(C,{name:"subscription_plan_id",value:o.subscription_plan_id,onValueChange:s=>b("subscription_plan_id",s),children:[e.jsx(D,{children:e.jsx(w,{placeholder:"Seleccione un plan"})}),e.jsx(F,{children:f.map(s=>e.jsxs(x,{value:s.id.toString(),children:[s.name," - $",s.price]},s.id))})]}),m.subscription_plan_id&&e.jsx("p",{className:"text-sm text-red-500",children:m.subscription_plan_id})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"trial_ends_at",children:"Fin del Período de Prueba"}),e.jsxs("div",{className:"relative",children:[e.jsx(I,{id:"trial_ends_at",name:"trial_ends_at",type:"date",value:o.trial_ends_at,onChange:p}),e.jsx(U,{className:"absolute top-2.5 right-3 h-4 w-4 text-gray-500"})]}),m.trial_ends_at&&e.jsx("p",{className:"text-sm text-red-500",children:m.trial_ends_at})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"subscription_ends_at",children:"Fin de la Suscripción"}),e.jsxs("div",{className:"relative",children:[e.jsx(I,{id:"subscription_ends_at",name:"subscription_ends_at",type:"date",value:o.subscription_ends_at,onChange:p}),e.jsx(U,{className:"absolute top-2.5 right-3 h-4 w-4 text-gray-500"})]}),m.subscription_ends_at&&e.jsx("p",{className:"text-sm text-red-500",children:m.subscription_ends_at})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("input",{id:"subscription_active",name:"subscription_active",type:"checkbox",className:"h-4 w-4 rounded border-gray-300 text-indigo-600 focus:ring-indigo-500",checked:o.subscription_active,onChange:p}),e.jsx(n,{htmlFor:"subscription_active",children:"Suscripción Activa"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("input",{id:"is_active",name:"is_active",type:"checkbox",className:"h-4 w-4 rounded border-gray-300 text-indigo-600 focus:ring-indigo-500",checked:o.is_active,onChange:p}),e.jsx(n,{htmlFor:"is_active",children:"Inquilino Activo"})]})]}),e.jsxs(Z,{children:[e.jsx(d,{type:"button",variant:"outline",onClick:()=>N(!1),children:"Cancelar"}),e.jsx(d,{type:"submit",disabled:y,children:y?"Actualizando...":"Actualizar Suscripción"})]})]})})]}),e.jsx(G,{href:route("admin.tenants.reset-admin",i.id),className:"w-full",children:e.jsx(d,{variant:"outline",className:"mb-4 w-full",children:"Resetear Credenciales de Admin"})}),e.jsx(d,{variant:"outline",className:"w-full",onClick:()=>{P.visit(route("admin.tenants.index"))},children:"Volver a la Lista"})]})]})})]})]})]})}export{ts as default};
