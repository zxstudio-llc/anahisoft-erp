import{r as p,j as e,a as I}from"./app-DQczwFTk.js";import{B as f}from"./button-BYXnJyXv.js";import{I as N}from"./input-goWATpHJ.js";import{S as he,a as me,b as xe,c as pe,d as K}from"./select-D52pRjk-.js";import{D as ge,b as fe,c as ve,d as je,e as be,f as Ne}from"./dialog-DHq7tLZ5.js";import{B as F}from"./badge-CIPxAGrn.js";import{L as h}from"./label-BchK1h47.js";import{C as L}from"./checkbox-Cvj9wDgC.js";import{S as Se}from"./switch-x9PZ-zT7.js";import{S as Q}from"./separator-Dm1V7ums.js";import{c as W}from"./utils-CPN-yreq.js";import"./app-C-su-A41.js";import"./index-D2mu7mBH.js";import"./index-CTC3mW-r.js";import"./index-BBPPPnEU.js";import"./index-BfMh8EvQ.js";import"./index-KJ4lOR0W.js";import"./index-DSuT5VJt.js";import"./index-CnB8Y-kE.js";import"./index-CqVE9Fls.js";import"./index-BOxxC3ps.js";import"./index-ClSqUjUN.js";import"./createLucideIcon-D40S4Mwt.js";import"./index-7Ou4doz_.js";import"./index-CX1ZUDb2.js";import"./chevron-down-Bqmppv4h.js";import"./index-DcW1-0jE.js";import"./index-BVHM8iLO.js";import"./x-CNv1352c.js";function Xe({items:x,onReorder:M,menuItemTypes:k={},menuTitle:P="",menuId:X}){const[t,u]=p.useState(null),[d,S]=p.useState(new Set),[T,Z]=p.useState(new Set),[v,z]=p.useState(null),[g,j]=p.useState(null),[R,y]=p.useState("before"),C=p.useRef(0),ee=s=>{const r=new Set(d);r.has(s)?r.delete(s):r.add(s),S(r)},B=()=>{d.size===D(x).length?S(new Set):S(new Set(D(x)))},D=s=>{let r=[];return s.forEach(a=>{r.push(a.id),a.children&&(r=r.concat(D(a.children)))}),r},se=s=>{const r=new Set(T);r.has(s)?r.delete(s):r.add(s),Z(r)},re=()=>{d.size!==0&&confirm(`¿Eliminar ${d.size} elemento(s) seleccionado(s)?`)&&(d.forEach(s=>{I.delete(`/admin/menu-items/${s}`)}),S(new Set))},te=(s,r)=>{z(r),s.dataTransfer.effectAllowed="move",s.dataTransfer.setData("text/html",s.currentTarget.outerHTML),s.currentTarget.style.opacity="0.5"},ne=s=>{s.currentTarget.style.opacity="1",z(null),j(null),C.current=0},ae=(s,r)=>{s.preventDefault(),s.dataTransfer.dropEffect="move";const a=s.currentTarget.getBoundingClientRect(),o=s.clientY-a.top,l=a.height;o<l*.25?y("before"):o>l*.75?y("after"):y("inside"),j(r)},le=s=>{s.preventDefault(),C.current++},ie=s=>{C.current--,C.current===0&&j(null)},U=async(s,r)=>{if(s.preventDefault(),!(!v||v.id===r.id))try{let a;r.id===-1?a=ce(x,v):a=de(x,v,r,R),M&&await M(a)}catch(a){console.error("Error en el reordenamiento:",a),alert("Error al reordenar los elementos. Por favor intente nuevamente.")}finally{z(null),j(null)}},ce=(s,r)=>{const a=JSON.parse(JSON.stringify(s)),o=l=>{for(let n=0;n<l.length;n++){if(l[n].id===r.id)return l.splice(n,1),!0;if(l[n].children&&o(l[n].children||[]))return!0}return!1};return o(a),a.push({...r,parent_id:null}),a.map((l,n)=>({id:l.id,order:Math.max(1,n+1),parent_id:null}))},de=(s,r,a,o)=>{var Y;const l=JSON.parse(JSON.stringify(s)),n=(i,_,b=null)=>{for(let c=0;c<i.length;c++){if(i[c].id===_)return{item:i[c],parentItems:i,parentItem:b};if(i[c].children){const w=n(i[c].children||[],_,i[c]);if(w)return w}}return null},E=n(l,r.id),m=n(l,a.id);if(!E||!m)return[];const ue=E.parentItems.findIndex(i=>i.id===E.item.id),[A]=E.parentItems.splice(ue,1);let O=m.parentItems,$=m.parentItems.findIndex(i=>i.id===m.item.id);o==="inside"?(m.item.children||(m.item.children=[]),O=m.item.children,$=O.length,A.parent_id=m.item.id):(A.parent_id=((Y=m.parentItem)==null?void 0:Y.id)||null,o==="after"&&$++),O.splice($,0,A);const G=(i,_=null)=>i.reduce((b,c,w)=>(b.push({id:c.id,order:w+1,parent_id:_}),c.children&&c.children.length>0&&b.push(...G(c.children,c.id)),b),[]);return G(l)},oe=s=>{if((g==null?void 0:g.id)!==s.id)return"";switch(R){case"before":return"border-t-4 border-blue-500 mt-1";case"after":return"border-b-4 border-blue-500 mb-1";case"inside":return"bg-blue-50 border-2 border-blue-300 border-dashed";default:return""}},J=(s,r=0)=>{const a=s.children&&s.children.length>0,o=T.has(s.id),l=d.has(s.id);return e.jsxs("div",{className:"select-none",children:[e.jsxs("div",{className:`flex items-center justify-between bg-white p-3 rounded border cursor-move ${oe(s)} ${l?"ring-2 ring-blue-500":""}`,style:{marginLeft:`${r*20}px`},draggable:!0,onDragStart:n=>te(n,s),onDragEnd:ne,onDragOver:n=>ae(n,s),onDragEnter:le,onDragLeave:ie,onDrop:n=>U(n,s),children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(L,{checked:l,onCheckedChange:()=>ee(s.id),onClick:n=>n.stopPropagation()}),a&&e.jsx(f,{variant:"ghost",size:"sm",className:"p-1 h-6 w-6",onClick:n=>{n.stopPropagation(),se(s.id)},children:o?"▼":"▶"}),e.jsxs("div",{className:"flex-1 space-y-1",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[!s.is_active&&e.jsx(F,{variant:"destructive",children:"Inactivo"}),e.jsx("strong",{className:s.is_active?"text-gray-900":"text-gray-400",children:s.label}),e.jsxs("span",{className:"text-sm text-gray-500",children:["(",(k==null?void 0:k[s.type])||s.type,")"]})]}),e.jsxs("div",{className:"text-sm text-gray-600",children:[s.url," ",s.target==="_blank"&&e.jsx("span",{className:"text-xs",children:"(Nueva ventana)"})]}),s.css_class&&e.jsxs("div",{className:"text-xs text-gray-500",children:["CSS: ",s.css_class]})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs(F,{variant:"outline",children:["#",s.order]}),e.jsx(f,{variant:"outline",size:"sm",onClick:()=>u(s),children:"Editar"}),e.jsx(f,{variant:"destructive",size:"sm",onClick:()=>{confirm("¿Eliminar este elemento del menú?")&&I.delete(`/admin/menu-items/${s.id}`)},children:"Eliminar"})]})]}),a&&o&&e.jsx("div",{className:"mt-2",children:s.children.map(n=>J(n,r+1))})]},s.id)},q=s=>{s.preventDefault(),t&&I.put(`/admin/menu-items/${t.id}`,{label:t.label,url:t.url,type:t.type,target:t.target,css_class:t.css_class,order:t.order,parent_id:t.parent_id,is_active:t.is_active},{onSuccess:()=>{u(null),X&&I.reload()},onError:r=>{console.error("Error al actualizar:",r),alert(r.message||"Error al actualizar el elemento")}})},H=D(x),V=d.size===H.length&&H.length>0;return e.jsx(e.Fragment,{children:e.jsxs("div",{className:"space-y-6",children:[P&&e.jsxs("div",{children:[e.jsx(h,{htmlFor:"menu-name",children:"Nombre del Menú"}),e.jsx(N,{id:"menu-name",value:P,readOnly:!0,className:"bg-gray-150"})]}),e.jsxs("div",{className:"border rounded-md",children:[e.jsxs("div",{className:"p-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(L,{id:"bulk-select-all",checked:V,onCheckedChange:B}),e.jsxs(h,{htmlFor:"bulk-select-all",children:["Selección múltiple ",d.size>0&&`(${d.size} seleccionados)`]})]}),d.size>0&&e.jsxs(f,{variant:"destructive",size:"sm",onClick:re,children:["Eliminar seleccionados (",d.size,")"]})]}),e.jsx("p",{className:"text-sm text-muted-foreground mt-2",children:d.size===0?"Añade elementos al menú desde la columna izquierda.":"Arrastra los elementos para reordenarlos o usa los controles de selección múltiple."})]}),e.jsx(Q,{}),e.jsxs("div",{className:"p-4",children:[e.jsx("div",{className:"p-4 mb-4 border-2 border-dashed rounded-lg",onDragOver:s=>{s.preventDefault(),y("before"),j({id:-1})},onDrop:s=>{v&&U(s,{id:-1,parent_id:null})},children:e.jsx("div",{className:`text-center p-2 ${(g==null?void 0:g.id)===-1?"bg-blue-50":""}`,children:e.jsx(h,{children:"Soltar aquí para mover a la raíz del menú"})})}),e.jsx("div",{className:"space-y-2",children:x&&x.length>0?x.map(s=>J(s)):e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:"No hay elementos en este menú"})})]}),e.jsx(Q,{}),e.jsxs("div",{className:"p-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(L,{id:"bulk-select-footer",checked:V,onCheckedChange:B}),e.jsx(h,{htmlFor:"bulk-select-footer",children:"Selección múltiple"})]}),e.jsx("p",{className:"text-sm text-muted-foreground mt-2",children:"Eliminar elementos seleccionados."})]})]}),e.jsx(ge,{open:!!t,onOpenChange:()=>u(null),children:e.jsxs(fe,{children:[e.jsxs(ve,{children:[e.jsx(je,{children:"Editar Elemento"}),e.jsx(be,{children:"Modifica los campos y guarda los cambios."})]}),t&&e.jsxs(e.Fragment,{children:[e.jsxs("form",{onSubmit:q,className:"space-y-4 mt-4",children:[e.jsxs("div",{className:"flex gap-4",children:[e.jsxs("div",{className:"w-full",children:[e.jsx(h,{children:"Texto del enlace"}),e.jsx(N,{value:t.label??"",onChange:s=>u({...t,label:s.target.value}),required:!0})]}),e.jsxs("div",{className:"w-full",children:[e.jsx(h,{children:"URL"}),e.jsx(N,{value:t.url??"",onChange:s=>u({...t,url:s.target.value})})]})]}),e.jsxs("div",{className:"flex gap-4",children:[e.jsxs("div",{className:"w-full",children:[e.jsx(h,{children:"Abrir en"}),e.jsxs(he,{value:t.target??"_self",onValueChange:s=>u({...t,target:s}),children:[e.jsx(me,{children:e.jsx(xe,{placeholder:"Seleccionar"})}),e.jsxs(pe,{children:[e.jsx(K,{value:"_self",children:"Misma ventana"}),e.jsx(K,{value:"_blank",children:"Nueva ventana"})]})]})]}),e.jsxs("div",{className:"w-full",children:[e.jsx(h,{children:"Clase CSS"}),e.jsx(N,{value:t.css_class??"",onChange:s=>u({...t,css_class:s.target.value}),placeholder:"class1 class2"})]})]}),e.jsxs("div",{className:"flex gap-4",children:[e.jsxs("div",{className:"w-full",children:[e.jsx(h,{children:"Orden"}),e.jsx(N,{type:"number",min:"0",value:t.order??0,onChange:s=>u({...t,order:parseInt(s.target.value)})})]}),e.jsxs("div",{className:"w-1/3",children:[e.jsx(h,{children:"Estado"}),e.jsx("div",{className:"flex items-center gap-2 mt-1",children:e.jsxs("div",{children:[e.jsx(F,{className:W("rounded-full text-xs px-3 py-1",t.is_active?"bg-green-100 text-green-800":"bg-red-100 text-red-800"),children:t.is_active?"Activo":"Inactivo"}),e.jsx(Se,{id:"is_active",checked:!!t.is_active,onCheckedChange:s=>u({...t,is_active:!!s}),className:W(t.is_active?"data-[state=checked]:bg-green-600":"data-[state=unchecked]:bg-red-600")})]})})]})]})]}),e.jsxs(Ne,{className:"pt-4 flex flex-row gap-3",children:[e.jsx(f,{type:"button",onClick:q,children:"Guardar"}),e.jsx(f,{type:"button",variant:"destructive",onClick:()=>u(null),children:"Cancelar"})]})]})]})})]})})}export{Xe as default};
