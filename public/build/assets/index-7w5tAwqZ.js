import{U as S,j as e,r as g,a as F,H as _}from"./app-DQczwFTk.js";import{A as M}from"./app-layout-CxNCz1W0.js";import{u as A,f as y,d as k,e as E,a as V,b as K,g as P,c as U}from"./index-CwDE0SfU.js";import{T as H,a as B,b as j,c as I,d as L,e as C}from"./table-J6M9UKS6.js";import{D as $,a as q}from"./data-table-view-options-NQL8x2eE.js";import{B as T}from"./button-BYXnJyXv.js";import{I as G}from"./input-goWATpHJ.js";import{X as O}from"./x-CNv1352c.js";import{C as N}from"./checkbox-Cvj9wDgC.js";import{D as d}from"./data-table-column-header-uei8EkBj.js";import{B as m}from"./badge-CIPxAGrn.js";import{D as X,a as z,b as J,c as w}from"./dropdown-menu-DWIT9g2E.js";import{t as b}from"./index-Cou6Ygo0.js";import{E as Q}from"./ellipsis-YiHoVY6K.js";import{S as W}from"./square-pen-NJFtVg51.js";import{T as Y}from"./trash-2-b2Qe_qpo.js";import{T as Z,a as ee,b as f}from"./tabs-C6TkS0W8.js";import"./app-C-su-A41.js";import"./tenant-status-listener-Bzjk6yNz.js";import"./toast-lvG1LsW6.js";import"./app-sidebar-layout-DjIGW_b8.js";import"./index-D2mu7mBH.js";import"./utils-CPN-yreq.js";import"./index-DcW1-0jE.js";import"./index-BBPPPnEU.js";import"./index-KJ4lOR0W.js";import"./index-CqVE9Fls.js";import"./index-DSuT5VJt.js";import"./index-CnB8Y-kE.js";import"./index-CTC3mW-r.js";import"./index-BVHM8iLO.js";import"./index-BOxxC3ps.js";import"./index-ClSqUjUN.js";import"./createLucideIcon-D40S4Mwt.js";import"./index-CX1ZUDb2.js";import"./avatar-CLHvFKAC.js";import"./receipt-BIwab1oI.js";import"./file-text-mqHhLRuK.js";import"./folder-BRrK2jGA.js";import"./credit-card-DX0EPogz.js";import"./key-aou-cbKc.js";import"./shield-BhSokjS6.js";import"./dollar-sign-OeXEXPCy.js";import"./search-DPYN2drD.js";import"./app-logo-icon-2MFPo7KO.js";import"./cookie-consent-DYpW6VIi.js";import"./card-BNPG6E-E.js";import"./select-D52pRjk-.js";import"./index-BfMh8EvQ.js";import"./index-7Ou4doz_.js";import"./chevron-down-Bqmppv4h.js";import"./chevron-left-C9_3M9nq.js";import"./eye-off-B_owjCxK.js";import"./index-CJpv9kZ5.js";function se({table:a,onResetSearch:o}){const s=a.getState().columnFilters.length>0,[t,r]=S.useState("");return S.useEffect(()=>{a.setGlobalFilter(t)},[t]),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex flex-1 items-center space-x-2",children:[e.jsx(G,{placeholder:"Buscar por nombre, email, DNI...",value:t,onChange:i=>r(i.target.value),className:"h-8 w-[150px] lg:w-[250px]"}),s&&e.jsxs(T,{variant:"ghost",onClick:()=>{a.resetColumnFilters(),r(""),o&&o()},className:"h-8 px-2 lg:px-3",children:["Reset",e.jsx(O,{})]})]}),e.jsx($,{table:a})]})}function te({columns:a,data:o,filterKey:s,meta:t}){var v;const[r,i]=g.useState({}),[c,u]=g.useState({}),[l,h]=g.useState([]),[R,D]=g.useState([]),p=A({data:o,columns:a,meta:t,state:{sorting:R,columnVisibility:c,rowSelection:r,columnFilters:l},enableRowSelection:!0,onRowSelectionChange:i,onSortingChange:D,onColumnFiltersChange:h,onColumnVisibilityChange:u,getCoreRowModel:U(),getFilteredRowModel:P(),getPaginationRowModel:K(),getSortedRowModel:V(),getFacetedRowModel:E(),getFacetedUniqueValues:k()});return e.jsxs("div",{className:"space-y-4",children:[e.jsx(se,{table:p,onResetSearch:()=>p.setGlobalFilter("")}),e.jsx("div",{className:"rounded-md border",children:e.jsxs(H,{children:[e.jsx(B,{children:p.getHeaderGroups().map(x=>e.jsx(j,{children:x.headers.map(n=>e.jsx(I,{colSpan:n.colSpan,children:n.isPlaceholder?null:y(n.column.columnDef.header,n.getContext())},n.id))},x.id))}),e.jsx(L,{children:(v=p.getRowModel().rows)!=null&&v.length?p.getRowModel().rows.map(x=>e.jsx(j,{"data-state":x.getIsSelected()&&"selected",children:x.getVisibleCells().map(n=>e.jsx(C,{children:y(n.column.columnDef.cell,n.getContext())},n.id))},x.id)):e.jsx(j,{children:e.jsx(C,{colSpan:a.length,className:"h-24 text-center",children:"No results."})})})]})}),e.jsx(q,{table:p})]})}function re({row:a,roles:o,currentUserId:s}){const t=a.original,r=s?t.id===s:!1,i=()=>{if(r)return b.error("No puedes eliminarte a ti mismo");confirm("¿Estás seguro de eliminar este administrador?")&&F.delete(route("admin.users.destroy",t.id),{onSuccess:()=>b.success("Administrador eliminado"),onError:()=>b.error("Error al eliminar")})};return e.jsxs(X,{children:[e.jsx(z,{asChild:!0,children:e.jsx(T,{variant:"ghost",className:"h-8 w-8 p-0",children:e.jsx(Q,{className:"h-4 w-4"})})}),e.jsxs(J,{align:"end",children:[e.jsx(w,{asChild:!0,children:e.jsxs("a",{href:route("admin.users.edit",t.id),className:"flex items-center",onClick:r?c=>c.preventDefault():void 0,children:[e.jsx(W,{className:"mr-2 h-4 w-4"}),r?"Ver perfil":"Editar"]})}),!r&&!t.roles.some(c=>c.name==="Super admin")&&e.jsxs(w,{onClick:i,className:"text-red-600",children:[e.jsx(Y,{className:"mr-2 h-4 w-4"}),"Eliminar"]})]})]})}const ae=(a,o)=>[{id:"select",header:({table:s})=>e.jsx(N,{checked:s.getIsAllPageRowsSelected(),onCheckedChange:t=>s.toggleAllPageRowsSelected(!!t),"aria-label":"Select all"}),cell:({row:s})=>e.jsx(N,{checked:s.getIsSelected(),onCheckedChange:t=>s.toggleSelected(!!t),"aria-label":"Select row"}),enableSorting:!1,enableHiding:!1},{accessorKey:"email",header:({column:s})=>e.jsx(d,{column:s,title:"Email"}),cell:({row:s})=>{const t=s.original.id===o;return e.jsxs("div",{className:"flex items-center",children:[t&&e.jsx("span",{className:"mr-2 h-2 w-2 rounded-full bg-green-500"}),e.jsx("span",{className:t?"font-medium":"",children:s.original.email}),t&&e.jsx("span",{className:"ml-2 text-xs text-muted-foreground",children:"(Tú)"})]})}},{accessorKey:"name",accessorFn:s=>`${s.first_name} ${s.last_name}`,header:({column:s})=>e.jsx(d,{column:s,title:"Nombre"}),cell:({row:s})=>`${s.original.first_name} ${s.original.last_name}`},{accessorKey:"dni",header:({column:s})=>e.jsx(d,{column:s,title:"Documento"}),cell:({row:s})=>s.original.dni||"-"},{accessorKey:"status",header:({column:s})=>e.jsx(d,{column:s,title:"Estado"}),cell:({row:s})=>e.jsx(m,{variant:s.original.status?"default":"destructive",children:s.original.status?"Activo":"Inactivo"}),filterFn:(s,t,r)=>r.includes(s.getValue(t))},{accessorKey:"user_type",header:({column:s})=>e.jsx(d,{column:s,title:"Tipo"}),cell:({row:s})=>{const t=s.original.user_type;let r,i;switch(t){case"admin":r="default",i="Administrador";break;case"provider":r="secondary",i="Proveedor";break;case"customer":r="outline",i="Cliente";break;default:r="destructive",i="Desconocido"}return e.jsx(m,{variant:r,children:i})},filterFn:(s,t,r)=>r.includes(s.getValue(t))},{accessorKey:"roles",header:({column:s})=>e.jsx(d,{column:s,title:"Roles"}),cell:({row:s})=>{var t;return e.jsx("div",{className:"flex flex-wrap gap-1",children:(t=s.original.roles)==null?void 0:t.map(r=>e.jsx(m,{variant:r.name==="Super admin"?"destructive":"secondary",children:r.name},r.id))})}},{accessorKey:"created_at",header:({column:s})=>e.jsx(d,{column:s,title:"Registro"}),cell:({row:s})=>{const t=new Date(s.original.created_at);return e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{children:t.toLocaleDateString()}),e.jsx("span",{className:"text-xs text-muted-foreground",children:t.toLocaleTimeString()})]})},sortingFn:"datetime"},{id:"actions",cell:({row:s})=>e.jsx(re,{row:s,roles:a,currentUserId:o}),enableSorting:!1,enableHiding:!1}],ie=[{title:"Dashboard",href:"/admin"},{title:"Usuarios",href:"/admin/users"}];function ls({users:a,roles:o,currentUserId:s}){const t=ae(o,s),[r,i]=g.useState("all"),c=a.filter(l=>r==="all"?!0:r==="super_admin"?l.roles.some(h=>h.name==="Super admin"):r==="provider"?l.user_type==="provider":r==="customer"?l.user_type==="customer":!0),u={super_admin:a.filter(l=>l.roles.some(h=>h.name==="Super admin")).length,provider:a.filter(l=>l.user_type==="provider").length,customer:a.filter(l=>l.user_type==="customer").length,all:a.length};return e.jsxs(M,{breadcrumbs:ie,children:[e.jsx(_,{title:"Gestión de Usuarios"}),e.jsxs("div",{className:"hidden h-full flex-1 flex-col space-y-8 p-8 md:flex",children:[e.jsxs("div",{className:"flex items-center justify-between space-y-2",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold tracking-tight",children:"Todos los Usuarios"}),e.jsx("p",{className:"text-muted-foreground",children:"Lista completa de usuarios del sistema"})]}),e.jsx("a",{href:route("admin.users.create"),className:"inline-flex items-center justify-center rounded-md bg-primary px-4 py-2 text-sm font-medium text-primary-foreground shadow transition-colors hover:bg-primary/90",children:"Nuevo Usuario"})]}),e.jsx("div",{className:"flex items-center justify-center space-y-2",children:e.jsx(Z,{value:r,onValueChange:i,children:e.jsxs(ee,{children:[e.jsxs(f,{value:"super_admin",children:["Super Admins ",e.jsx(m,{className:"ml-2",children:u.super_admin})]}),e.jsxs(f,{value:"provider",children:["Providers ",e.jsx(m,{className:"ml-2",children:u.provider})]}),e.jsxs(f,{value:"customer",children:["Customers ",e.jsx(m,{className:"ml-2",children:u.customer})]}),e.jsxs(f,{value:"all",children:["All Users ",e.jsx(m,{className:"ml-2",children:u.all})]})]})})}),e.jsx(te,{columns:t,data:c,filterKey:"email",meta:{currentUserId:s}})]})]})}export{ls as default};
