import{r,j as e,H as E}from"./app-DQczwFTk.js";import{t as s}from"./index-Cou6Ygo0.js";import{A as S}from"./api-DdUbHrO8.js";import{A as T}from"./app-layout-CxNCz1W0.js";import{B as g}from"./button-BYXnJyXv.js";import{a as _,d as M}from"./card-BNPG6E-E.js";import{D as F,b as K,c as O,d as z,e as H,f as D}from"./dialog-DHq7tLZ5.js";import{I as L}from"./input-goWATpHJ.js";import{L as A}from"./label-BchK1h47.js";import{S as R,a as V,b as G,c as B,d as j}from"./select-D52pRjk-.js";import{A as $,b as q}from"./alert-C2Fc1m40.js";import{T as J}from"./triangle-alert-dUu2CXl0.js";import{C as Q}from"./index-ClSqUjUN.js";import{c as U}from"./createLucideIcon-D40S4Mwt.js";import{DataTable as W}from"./data-table-BTizLlUL.js";import{createColumns as X}from"./columns-BwnhiGDO.js";import{K as Y}from"./key-aou-cbKc.js";import{P as Z}from"./plus-BGuKkasZ.js";import"./app-C-su-A41.js";import"./index-CTC3mW-r.js";import"./tenant-status-listener-Bzjk6yNz.js";import"./toast-lvG1LsW6.js";import"./app-sidebar-layout-DjIGW_b8.js";import"./index-D2mu7mBH.js";import"./utils-CPN-yreq.js";import"./index-DcW1-0jE.js";import"./index-BBPPPnEU.js";import"./index-KJ4lOR0W.js";import"./index-CqVE9Fls.js";import"./index-DSuT5VJt.js";import"./index-CnB8Y-kE.js";import"./index-BVHM8iLO.js";import"./x-CNv1352c.js";import"./index-BOxxC3ps.js";import"./index-CX1ZUDb2.js";import"./dropdown-menu-DWIT9g2E.js";import"./index-BfMh8EvQ.js";import"./index-CJpv9kZ5.js";import"./avatar-CLHvFKAC.js";import"./receipt-BIwab1oI.js";import"./file-text-mqHhLRuK.js";import"./folder-BRrK2jGA.js";import"./credit-card-DX0EPogz.js";import"./shield-BhSokjS6.js";import"./dollar-sign-OeXEXPCy.js";import"./search-DPYN2drD.js";import"./app-logo-icon-2MFPo7KO.js";import"./cookie-consent-DYpW6VIi.js";import"./index-7Ou4doz_.js";import"./chevron-down-Bqmppv4h.js";import"./index-CwDE0SfU.js";import"./table-J6M9UKS6.js";import"./arrow-up-down-CdH8iRBF.js";import"./trash-2-b2Qe_qpo.js";/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ee=[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]],ae=U("Copy",ee);function re({isOpen:u,onClose:C,onSuccess:v}){const[a,i]=r.useState({name:"",abilities:["*"],expiration:null}),[m,y]=r.useState(!1),[t,b]=r.useState(null),[k,p]=r.useState(!1),N=async o=>{o.preventDefault(),y(!0);try{const n={name:a.name.trim(),abilities:a.abilities};a.expiration&&a.expiration.trim()!==""&&(n.expiration=a.expiration),console.log("📤 Enviando datos:",n);const h=await S.post("/v1/api-keys",n);console.log("✅ Respuesta recibida:",h);const c=h.data;if(c&&c.success&&c.data&&c.data.token)b(c.data.token),s.success(c.message||"Llave API creada correctamente");else throw console.error("🔍 Estructura de respuesta inesperada:",c),new Error("No se pudo obtener el token de la respuesta del servidor")}catch(n){console.error("❌ Error al crear llave API:",n),n instanceof Error?s.error(`Error al crear la llave API: ${n.message}`):s.error("Error desconocido al crear la llave API")}finally{y(!1)}},f=()=>{t&&(v==null||v()),b(null),p(!1),i({name:"",abilities:["*"],expiration:null}),C()},I=async()=>{if(t)try{await navigator.clipboard.writeText(t),p(!0),s.success("Token copiado al portapapeles"),setTimeout(()=>p(!1),2e3)}catch(o){console.error("Error al copiar:",o),s.error("No se pudo copiar el token")}};return e.jsx(F,{open:u,onOpenChange:f,children:e.jsxs(K,{className:"sm:max-w-[500px]",children:[e.jsxs(O,{children:[e.jsx(z,{children:t?"API Key Creada":"Crear Llave API"}),e.jsx(H,{children:t?"Copia tu llave API. Esta clave solo se mostrará una vez.":"Las API Keys permiten a aplicaciones externas acceder a tu cuenta. Asegúrate de guardar la clave en un lugar seguro."})]}),t?e.jsxs("div",{className:"space-y-4 py-2",children:[e.jsxs($,{className:"border-amber-200 bg-amber-50 text-amber-800",children:[e.jsx(J,{className:"h-4 w-4"}),e.jsx(q,{children:"Esta clave solo se mostrará una vez. Guárdala en un lugar seguro."})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(A,{children:"Tu llave API"}),e.jsxs("div",{className:"flex items-center gap-2 p-3 bg-muted rounded-md",children:[e.jsx("div",{className:"overflow-x-auto flex-1 font-mono text-sm break-all",children:t}),e.jsx(g,{variant:"outline",size:"icon",onClick:I,className:"flex-shrink-0",title:"Copiar token",children:k?e.jsx(Q,{className:"h-4 w-4 text-green-600"}):e.jsx(ae,{className:"h-4 w-4"})})]})]}),e.jsxs("div",{className:"text-sm text-muted-foreground space-y-1",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Nombre:"})," ",a.name]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Permisos:"})," ",a.abilities.join(", ")]}),a.expiration&&e.jsxs("p",{children:[e.jsx("strong",{children:"Expira:"})," ",new Date(a.expiration).toLocaleDateString()]})]}),e.jsx(D,{children:e.jsx(g,{onClick:f,className:"w-full",children:"Cerrar"})})]}):e.jsxs("form",{onSubmit:N,className:"space-y-4 py-2",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(A,{htmlFor:"name",children:"Nombre *"}),e.jsx(L,{id:"name",value:a.name,onChange:o=>i({...a,name:o.target.value}),placeholder:"Ej: Sistema de facturación",required:!0,minLength:3,maxLength:100,disabled:m}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Mínimo 3 caracteres, máximo 100"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(A,{htmlFor:"abilities",children:"Permisos *"}),e.jsxs(R,{value:a.abilities[0],onValueChange:o=>i({...a,abilities:[o]}),disabled:m,children:[e.jsx(V,{children:e.jsx(G,{placeholder:"Selecciona los permisos"})}),e.jsxs(B,{children:[e.jsx(j,{value:"*",children:"Acceso completo"}),e.jsx(j,{value:"read",children:"Solo lectura"}),e.jsx(j,{value:"write",children:"Solo escritura"}),e.jsx(j,{value:"api:read",children:"API - Solo lectura"}),e.jsx(j,{value:"api:write",children:"API - Lectura y escritura"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(A,{htmlFor:"expiration",children:"Fecha de expiración (opcional)"}),e.jsx(L,{id:"expiration",type:"date",value:a.expiration||"",onChange:o=>i({...a,expiration:o.target.value||null}),min:new Date().toISOString().split("T")[0],disabled:m}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Si no seleccionas una fecha, la llave no expirará"})]}),e.jsxs(D,{children:[e.jsx(g,{type:"button",variant:"outline",onClick:f,disabled:m,children:"Cancelar"}),e.jsx(g,{type:"submit",disabled:m||!a.name.trim(),children:m?"Creando...":"Crear API Key"})]})]})]})})}function sa(){const[u,C]=r.useState([]),[v,a]=r.useState({current_page:1,from:0,last_page:1,to:0,total:0}),[i,m]=r.useState({search:"",sort_field:"created_at",sort_order:"desc",per_page:10,page:1}),[y,t]=r.useState(!1),[b,k]=r.useState(!1),p=async()=>{try{k(!0);const l=(await S.get("/v1/api-keys",{params:{params:i}})).data.tokens;C(l.data),a({current_page:l.current_page,from:l.from,last_page:l.last_page,to:l.to,total:l.total})}catch(x){console.error("Error al cargar tokens:",x),s.error("Error al cargar los tokens")}finally{k(!1)}},N=r.useCallback(async x=>{var l,w,P;console.log("Direct delete for token:",x.name,"ID:",x.id);try{const d=await S.delete(`/v1/api-keys/${x.id}`);console.log("Delete response:",d),d.success||(l=d.data)!=null&&l.success||d.status===200?(await p(),s.success("Token eliminado correctamente")):(console.error("Delete failed - response:",d),s.error("Error al eliminar el token"))}catch(d){console.error("Error al eliminar token:",d),((w=d.response)==null?void 0:w.status)===404?s.error("Token no encontrado"):((P=d.response)==null?void 0:P.status)===200?(await p(),s.success("Token eliminado correctamente")):s.error("Error al eliminar el token")}},[i]);r.useEffect(()=>{p()},[i]);const f=x=>{m(l=>({...l,search:x,page:1}))},I=()=>{if(u.length>=10){s.error("Has alcanzado el límite máximo de 10 llaves API");return}t(!0)},o=()=>{p(),t(!1)},n=r.useMemo(()=>X(N),[N]),h=u.length>=10,c=[{title:"Llaves API",href:"/api-keys"}];return e.jsxs(T,{breadcrumbs:c,children:[e.jsx(E,{title:"Llaves API"}),e.jsx("div",{className:"flex h-full flex-1 flex-col gap-4 overflow-x-auto rounded-xl p-4",children:e.jsxs("div",{children:[e.jsxs(_,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Y,{className:"h-6 w-6"}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-bold",children:"Llaves API"}),e.jsxs("p",{className:"text-sm text-gray-500",children:["Gestiona las llaves de acceso a la API (",u.length,"/10)"]})]})]}),e.jsxs("div",{className:"flex flex-col items-end",children:[e.jsxs(g,{onClick:I,disabled:h,className:h?"opacity-50 cursor-not-allowed":"",children:[e.jsx(Z,{className:"mr-2 h-4 w-4"}),"Nueva Llave API"]}),h&&e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Límite máximo: 10 llaves API"})]})]}),e.jsx(M,{children:e.jsx(W,{columns:n,data:u,onSearch:f,searchValue:i.search,isLoading:b})})]})}),e.jsx(re,{isOpen:y,onClose:()=>t(!1),onSuccess:o})]})}export{sa as default};
