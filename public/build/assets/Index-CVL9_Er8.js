import{r as m,j as e}from"./app-DQczwFTk.js";import{B as j}from"./button-BYXnJyXv.js";import{D as q,b as G,c as J,d as K,e as Q,f as W}from"./dialog-DHq7tLZ5.js";import{I as h}from"./input-goWATpHJ.js";import{L as u}from"./label-BchK1h47.js";import{C as X}from"./checkbox-Cvj9wDgC.js";import{A as k}from"./api-DdUbHrO8.js";import{t as g}from"./index-Cou6Ygo0.js";import{L as O}from"./loader-circle-0WVi89tk.js";import{C as Y,a as Z,d as ee}from"./card-BNPG6E-E.js";import{S as V,a as z,b as R,c as B,d as w}from"./select-D52pRjk-.js";import{A as se}from"./app-sidebar-layout-DjIGW_b8.js";import{C as M}from"./circle-user-BmLeNbtb.js";import{P as $}from"./plus-BGuKkasZ.js";import{S as ae}from"./search-DPYN2drD.js";import{P as te}from"./pencil-Chy_hZuP.js";import{T as re}from"./trash-2-b2Qe_qpo.js";import"./app-C-su-A41.js";import"./index-D2mu7mBH.js";import"./utils-CPN-yreq.js";import"./index-DcW1-0jE.js";import"./index-BBPPPnEU.js";import"./index-KJ4lOR0W.js";import"./index-CqVE9Fls.js";import"./index-DSuT5VJt.js";import"./index-CnB8Y-kE.js";import"./index-CTC3mW-r.js";import"./index-BVHM8iLO.js";import"./x-CNv1352c.js";import"./createLucideIcon-D40S4Mwt.js";import"./index-7Ou4doz_.js";import"./index-ClSqUjUN.js";import"./index-BfMh8EvQ.js";import"./index-BOxxC3ps.js";import"./index-CX1ZUDb2.js";import"./chevron-down-Bqmppv4h.js";import"./dropdown-menu-DWIT9g2E.js";import"./index-CJpv9kZ5.js";import"./avatar-CLHvFKAC.js";import"./receipt-BIwab1oI.js";import"./file-text-mqHhLRuK.js";import"./folder-BRrK2jGA.js";import"./credit-card-DX0EPogz.js";import"./key-aou-cbKc.js";import"./shield-BhSokjS6.js";import"./dollar-sign-OeXEXPCy.js";import"./app-logo-icon-2MFPo7KO.js";import"./toast-lvG1LsW6.js";function le({isOpen:b,onClose:F,client:c,documentTypes:P,onSuccess:n}){const d=!!c,[f,D]=m.useState(!1),[E,_]=m.useState(!1),[l,x]=m.useState({}),[t,i]=m.useState({name:"",document_type:"01",document_number:"",email:"",phone:"",address:"",district:"",province:"",department:"",country:"PE",ubigeo:"",is_active:!0});m.useEffect(()=>{i(c?{name:c.name||"",document_type:c.document_type||"01",document_number:c.document_number||"",email:c.email||"",phone:c.phone||"",address:c.address||"",district:c.district||"",province:c.province||"",department:c.department||"",country:c.country||"PE",ubigeo:c.ubigeo||"",is_active:c.is_active!==void 0?c.is_active:!0}:{name:"",document_type:"01",document_number:"",email:"",phone:"",address:"",district:"",province:"",department:"",country:"PE",ubigeo:"",is_active:!0})},[c,b]);const N=r=>"dni"in r,T=r=>"ruc"in r,S=m.useCallback(async()=>{if(!(!t.document_number||d)&&!(t.document_type==="01"&&t.document_number.length!==8)&&!(t.document_type==="06"&&t.document_number.length!==11)){_(!0);try{const r=await k.post("/v1/documents/validate",{document_type:t.document_type,document_number:t.document_number});if(r.data.success){const o=r.data;if(T(o))i(p=>({...p,name:o.businessName||"",address:o.address||"",ubigeo:o.ubigeo||"",department:o.department||"",province:o.province||"",district:o.district||""}));else if(N(o)){const p=`${o.firstName||""} ${o.lastName||""} ${o.motherLastName||""}`.trim();i(y=>({...y,name:p||""}))}g.success("Datos validados correctamente")}else g.error("No se pudo validar el documento")}catch(r){console.error("Error al validar documento:",r),g.error("Error al validar el documento")}finally{_(!1)}}},[t.document_type,t.document_number,d]);m.useEffect(()=>{(async()=>{const o=t.document_number,p=t.document_type;(p==="01"&&o.length===8||p==="06"&&o.length===11)&&await S()})()},[t.document_number,t.document_type,S]);const L=async r=>{var o,p,y,s;r.preventDefault(),D(!0),x({});try{let a;d&&c?(a=await k.put(`/v1/clients/${c.id}`,t),a.data.success&&(g.success(a.data.message),n&&n(a.data.data))):(a=await k.post("/v1/clients",t),a.data.success&&(g.success(a.data.message),n&&n(a.data.data))),v()}catch(a){console.error("Error:",a);const C=a;if((p=(o=C.response)==null?void 0:o.data)!=null&&p.errors){const A={};Object.entries(C.response.data.errors).forEach(([U,I])=>{A[U]=Array.isArray(I)?I[0]:I}),x(A);const H=Object.values(A)[0];g.error(H||"Error al procesar el formulario")}else g.error(((s=(y=C.response)==null?void 0:y.data)==null?void 0:s.message)||"Error al procesar la solicitud")}finally{D(!1)}},v=()=>{i({name:"",document_type:"01",document_number:"",email:"",phone:"",address:"",district:"",province:"",department:"",country:"PE",ubigeo:"",is_active:!0}),x({}),F()};return e.jsx(q,{open:b,onOpenChange:v,children:e.jsxs(G,{className:"sm:max-w-md md:max-w-lg",children:[e.jsxs(J,{children:[e.jsx(K,{children:d?"Editar Cliente":"Nuevo Cliente"}),e.jsx(Q,{children:d?"Actualice los datos del cliente.":"Complete la información para crear un nuevo cliente."})]}),e.jsxs("form",{onSubmit:L,className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-2",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs(u,{htmlFor:"name",children:["Nombre ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(h,{id:"name",value:t.name,onChange:r=>i({...t,name:r.target.value}),placeholder:"Nombre completo",className:l.name?"border-red-500":""}),l.name&&e.jsx("p",{className:"text-sm text-red-500",children:l.name})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(u,{htmlFor:"email",children:"Email"}),e.jsx(h,{id:"email",type:"email",value:t.email,onChange:r=>i({...t,email:r.target.value}),placeholder:"correo@ejemplo.com",className:l.email?"border-red-500":""}),l.email&&e.jsx("p",{className:"text-sm text-red-500",children:l.email})]})]}),e.jsxs("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-2",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs(u,{htmlFor:"document_type",children:["Tipo de Documento ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("select",{id:"document_type",className:`flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background ${l.document_type?"border-red-500":""}`,value:t.document_type,onChange:r=>i({...t,document_type:r.target.value}),disabled:d,children:P.map(r=>e.jsx("option",{value:r.value,children:r.label},r.value))}),l.document_type&&e.jsx("p",{className:"text-sm text-red-500",children:l.document_type})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(u,{htmlFor:"document_number",children:["Número de Documento ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("div",{className:"relative",children:[e.jsx(h,{id:"document_number",value:t.document_number,onChange:r=>i({...t,document_number:r.target.value}),placeholder:"Número de documento",className:`${l.document_number?"border-red-500":""} ${E?"pr-10":""}`,disabled:d}),E&&e.jsx("div",{className:"absolute inset-y-0 right-0 flex items-center pr-3",children:e.jsx(O,{className:"h-4 w-4 animate-spin text-gray-400"})})]}),l.document_number&&e.jsx("p",{className:"text-sm text-red-500",children:l.document_number})]})]}),e.jsxs("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-2",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(u,{htmlFor:"phone",children:"Teléfono"}),e.jsx(h,{id:"phone",value:t.phone,onChange:r=>i({...t,phone:r.target.value}),placeholder:"Número de teléfono",className:l.phone?"border-red-500":""}),l.phone&&e.jsx("p",{className:"text-sm text-red-500",children:l.phone})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(u,{htmlFor:"ubigeo",children:"Ubigeo"}),e.jsx(h,{id:"ubigeo",value:t.ubigeo,onChange:r=>i({...t,ubigeo:r.target.value}),placeholder:"Código de ubigeo",className:l.ubigeo?"border-red-500":""}),l.ubigeo&&e.jsx("p",{className:"text-sm text-red-500",children:l.ubigeo})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(u,{htmlFor:"address",children:"Dirección"}),e.jsx(h,{id:"address",value:t.address,onChange:r=>i({...t,address:r.target.value}),placeholder:"Dirección completa",className:l.address?"border-red-500":""}),l.address&&e.jsx("p",{className:"text-sm text-red-500",children:l.address})]}),e.jsxs("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-3",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(u,{htmlFor:"district",children:"Distrito"}),e.jsx(h,{id:"district",value:t.district,onChange:r=>i({...t,district:r.target.value}),placeholder:"Distrito",className:l.district?"border-red-500":""}),l.district&&e.jsx("p",{className:"text-sm text-red-500",children:l.district})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(u,{htmlFor:"province",children:"Provincia"}),e.jsx(h,{id:"province",value:t.province,onChange:r=>i({...t,province:r.target.value}),placeholder:"Provincia",className:l.province?"border-red-500":""}),l.province&&e.jsx("p",{className:"text-sm text-red-500",children:l.province})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(u,{htmlFor:"department",children:"Departamento"}),e.jsx(h,{id:"department",value:t.department,onChange:r=>i({...t,department:r.target.value}),placeholder:"Departamento",className:l.department?"border-red-500":""}),l.department&&e.jsx("p",{className:"text-sm text-red-500",children:l.department})]})]}),d&&e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(X,{id:"is_active",checked:t.is_active,onCheckedChange:r=>i({...t,is_active:!!r})}),e.jsx(u,{htmlFor:"is_active",className:"text-sm font-normal",children:"Cliente activo"})]}),e.jsxs(W,{children:[e.jsx(j,{type:"button",variant:"outline",onClick:v,disabled:f,children:"Cancelar"}),e.jsx(j,{type:"submit",disabled:f,children:f?e.jsxs(e.Fragment,{children:[e.jsx(O,{className:"mr-2 h-4 w-4 animate-spin"}),d?"Actualizando...":"Creando..."]}):e.jsxs(e.Fragment,{children:[d?"Actualizar":"Crear"," Cliente"]})})]})]})]})})}function es(){const[b,F]=m.useState([]),[c,P]=m.useState({current_page:1,from:0,last_page:1,links:[],path:"",per_page:10,to:0,total:0}),[n,d]=m.useState({search:"",document_type:"",is_active:null,sort_field:"created_at",sort_order:"desc",per_page:10}),[f,D]=m.useState([]),[E,_]=m.useState(!0),[l,x]=m.useState(!1),[t,i]=m.useState(void 0),N=m.useCallback(async()=>{try{_(!0);const s=await k.get("/v1/clients",{params:{...n,page:n.page}}),{data:a}=s;a.success&&(F(a.clients.data),P({current_page:a.clients.current_page,from:a.clients.from,last_page:a.clients.last_page,links:a.clients.links,path:a.clients.path,per_page:a.clients.per_page,to:a.clients.to,total:a.clients.total}),D(a.document_types))}catch(s){console.error("Error al cargar clientes:",s),g.error("Error al cargar los clientes")}finally{_(!1)}},[n]);m.useEffect(()=>{N()},[N]);const T=s=>{d(a=>({...a,search:s,page:1}))},S=s=>{d(a=>({...a,document_type:s==="all"?"":s,page:1}))},L=s=>{d(a=>({...a,is_active:s==="all"?null:s==="active",page:1}))},v=s=>{d(a=>({...a,sort_field:s,sort_order:a.sort_field===s&&a.sort_order==="asc"?"desc":"asc",page:1}))},r=s=>{d(a=>({...a,page:s}))},o=async s=>{if(confirm("¿Está seguro de eliminar este cliente?"))try{const a=await k.delete(`/v1/clients/${s.id}`);a.data.success&&(g.success(a.data.message),N())}catch(a){console.error("Error al eliminar cliente:",a),g.error("Error al eliminar el cliente")}},p=s=>{N(),x(!1),i(void 0)},y=[{title:"Inicio",href:"/"},{title:"Clientes",href:"/clients"}];return e.jsxs(se,{breadcrumbs:y,children:[e.jsx("div",{className:"flex h-full flex-1 flex-col gap-4 overflow-x-auto rounded-xl p-4",children:e.jsxs(Y,{children:[e.jsxs(Z,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(M,{className:"h-6 w-6"}),e.jsx("h2",{className:"text-2xl font-bold tracking-tight",children:"Clientes"})]}),e.jsxs(j,{onClick:()=>x(!0),children:[e.jsx($,{className:"mr-2 h-4 w-4"}),"Nuevo Cliente"]})]}),e.jsxs(ee,{children:[e.jsxs("div",{className:"mb-6 flex flex-col gap-4 md:flex-row",children:[e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"relative",children:[e.jsx(ae,{className:"absolute left-2 top-2.5 h-4 w-4 text-muted-foreground"}),e.jsx(h,{placeholder:"Buscar clientes...",value:n.search,onChange:s=>T(s.target.value),className:"pl-8"})]})}),e.jsxs(V,{value:n.document_type||"all",onValueChange:S,children:[e.jsx(z,{className:"w-[180px]",children:e.jsx(R,{placeholder:"Tipo de documento"})}),e.jsxs(B,{children:[e.jsx(w,{value:"all",children:"Todos los tipos"}),f.map(s=>e.jsx(w,{value:s.value,children:s.label},s.value))]})]}),e.jsxs(V,{value:n.is_active===null?"all":n.is_active?"active":"inactive",onValueChange:L,children:[e.jsx(z,{className:"w-[180px]",children:e.jsx(R,{placeholder:"Estado"})}),e.jsxs(B,{children:[e.jsx(w,{value:"all",children:"Todos los estados"}),e.jsx(w,{value:"active",children:"Activos"}),e.jsx(w,{value:"inactive",children:"Inactivos"})]})]})]}),e.jsx("div",{className:"relative overflow-x-auto",children:E?e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx("div",{className:"h-8 w-8 animate-spin rounded-full border-4 border-primary border-t-transparent"})}):b.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center py-8 text-center",children:[e.jsx(M,{className:"h-12 w-12 text-gray-400"}),c.total===0?e.jsxs(e.Fragment,{children:[e.jsx("h3",{className:"mt-2 text-sm font-medium text-gray-900 dark:text-gray-100",children:"No hay clientes registrados"}),e.jsx("p",{className:"mt-1 text-sm text-gray-500 dark:text-gray-400",children:"Para comenzar a usar el sistema, necesitas registrar al menos un cliente."}),e.jsx("div",{className:"mt-6",children:e.jsxs(j,{onClick:()=>x(!0),children:[e.jsx($,{className:"mr-2 h-4 w-4"}),"Registrar Primer Cliente"]})})]}):e.jsxs(e.Fragment,{children:[e.jsx("h3",{className:"mt-2 text-sm font-medium text-gray-900 dark:text-gray-100",children:"No se encontraron resultados"}),e.jsx("p",{className:"mt-1 text-sm text-gray-500 dark:text-gray-400",children:"No hay clientes que coincidan con los filtros aplicados."}),e.jsxs("div",{className:"mt-6 flex flex-col gap-2 sm:flex-row",children:[e.jsx(j,{variant:"outline",onClick:()=>d({search:"",document_type:"",is_active:null,sort_field:"created_at",sort_order:"desc",per_page:10}),children:"Limpiar filtros"}),e.jsxs(j,{onClick:()=>x(!0),children:[e.jsx($,{className:"mr-2 h-4 w-4"}),"Nuevo Cliente"]})]})]})]}):e.jsxs("table",{className:"w-full text-left text-sm text-gray-500 dark:text-gray-400",children:[e.jsx("thead",{className:"bg-gray-50 text-xs uppercase text-gray-700 dark:bg-gray-700 dark:text-gray-400",children:e.jsxs("tr",{children:[e.jsxs("th",{scope:"col",className:"cursor-pointer px-6 py-3",onClick:()=>v("id"),children:["ID",n.sort_field==="id"&&e.jsx("span",{className:"ml-1",children:n.sort_order==="asc"?"↑":"↓"})]}),e.jsxs("th",{scope:"col",className:"cursor-pointer px-6 py-3",onClick:()=>v("name"),children:["Nombre",n.sort_field==="name"&&e.jsx("span",{className:"ml-1",children:n.sort_order==="asc"?"↑":"↓"})]}),e.jsx("th",{scope:"col",className:"px-6 py-3",children:"Documento"}),e.jsx("th",{scope:"col",className:"px-6 py-3",children:"Email"}),e.jsx("th",{scope:"col",className:"px-6 py-3",children:"Teléfono"}),e.jsxs("th",{scope:"col",className:"cursor-pointer px-6 py-3",onClick:()=>v("created_at"),children:["Fecha de Registro",n.sort_field==="created_at"&&e.jsx("span",{className:"ml-1",children:n.sort_order==="asc"?"↑":"↓"})]}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-right",children:"Acciones"})]})}),e.jsx("tbody",{children:b.map(s=>e.jsxs("tr",{className:"border-b bg-white dark:border-gray-700 dark:bg-gray-800",children:[e.jsx("td",{className:"px-6 py-4",children:s.id}),e.jsxs("td",{className:"flex items-center gap-2 px-6 py-4 font-medium text-gray-900 dark:text-white",children:[e.jsx(M,{className:"h-5 w-5"}),s.name]}),e.jsxs("td",{className:"px-6 py-4",children:[s.document_type," - ",s.document_number]}),e.jsx("td",{className:"px-6 py-4",children:s.email||"-"}),e.jsx("td",{className:"px-6 py-4",children:s.phone||"-"}),e.jsx("td",{className:"px-6 py-4",children:new Date(s.created_at).toLocaleDateString()}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex items-center justify-end space-x-2",children:[e.jsx(j,{variant:"outline",size:"icon",onClick:()=>{i(s),x(!0)},children:e.jsx(te,{className:"h-4 w-4"})}),e.jsx(j,{variant:"outline",size:"icon",onClick:()=>o(s),children:e.jsx(re,{className:"h-4 w-4"})})]})})]},s.id))})]})}),c.last_page>1&&e.jsxs("div",{className:"mt-4 flex items-center justify-between",children:[e.jsxs("div",{className:"text-sm text-gray-700 dark:text-gray-400",children:["Mostrando ",e.jsx("span",{className:"font-medium",children:c.from})," a"," ",e.jsx("span",{className:"font-medium",children:c.to})," de"," ",e.jsx("span",{className:"font-medium",children:c.total})," resultados"]}),e.jsx("div",{className:"flex items-center space-x-2",children:c.links.map((s,a)=>e.jsx(j,{variant:s.active?"default":"outline",disabled:!s.url,onClick:()=>{if(s.url){const C=new URL(s.url).searchParams.get("page");r(Number(C))}},children:e.jsx("span",{dangerouslySetInnerHTML:{__html:s.label}})},a))})]})]})]})}),e.jsx(le,{isOpen:l,onClose:()=>{x(!1),i(void 0)},client:t,documentTypes:f,onSuccess:p})]})}export{es as default};
