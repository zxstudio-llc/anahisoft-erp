import{r as o,j as e,H as M}from"./app-DQczwFTk.js";import{B as d}from"./button-BYXnJyXv.js";import{D as z,b as A,c as F,d as H,e as O,f as T}from"./dialog-DHq7tLZ5.js";import{I as w}from"./input-goWATpHJ.js";import{L as b}from"./label-BchK1h47.js";import{C as $}from"./checkbox-Cvj9wDgC.js";import{A as y}from"./api-DdUbHrO8.js";import{t as x}from"./index-Cou6Ygo0.js";import{C as B,a as q,d as G}from"./card-BNPG6E-E.js";import{A as U}from"./app-layout-CxNCz1W0.js";import{c as V}from"./createLucideIcon-D40S4Mwt.js";import{P as C}from"./plus-BGuKkasZ.js";import{S as X}from"./search-DPYN2drD.js";import{C as J}from"./circle-x-DYOtRzZk.js";import{P as K}from"./pencil-Chy_hZuP.js";import{T as Q}from"./trash-2-b2Qe_qpo.js";import"./app-C-su-A41.js";import"./index-D2mu7mBH.js";import"./utils-CPN-yreq.js";import"./index-DcW1-0jE.js";import"./index-BBPPPnEU.js";import"./index-KJ4lOR0W.js";import"./index-CqVE9Fls.js";import"./index-DSuT5VJt.js";import"./index-CnB8Y-kE.js";import"./index-CTC3mW-r.js";import"./index-BVHM8iLO.js";import"./x-CNv1352c.js";import"./index-7Ou4doz_.js";import"./index-ClSqUjUN.js";import"./tenant-status-listener-Bzjk6yNz.js";import"./toast-lvG1LsW6.js";import"./app-sidebar-layout-DjIGW_b8.js";import"./index-BOxxC3ps.js";import"./index-CX1ZUDb2.js";import"./dropdown-menu-DWIT9g2E.js";import"./index-BfMh8EvQ.js";import"./index-CJpv9kZ5.js";import"./avatar-CLHvFKAC.js";import"./receipt-BIwab1oI.js";import"./file-text-mqHhLRuK.js";import"./folder-BRrK2jGA.js";import"./credit-card-DX0EPogz.js";import"./key-aou-cbKc.js";import"./shield-BhSokjS6.js";import"./dollar-sign-OeXEXPCy.js";import"./app-logo-icon-2MFPo7KO.js";import"./cookie-consent-DYpW6VIi.js";/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const W=[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]],Y=V("ShieldCheck",W),Z={search:"",sort_field:"name",sort_order:"asc",per_page:10};function ee({isOpen:u,onClose:h,role:t,permissions:N,onSuccess:l}){const[i,p]=o.useState({name:"",permissions:[]}),[f,j]=o.useState(!1);o.useEffect(()=>{p(t?{name:t.name,permissions:t.permissions.map(a=>a.name)}:{name:"",permissions:[]})},[t]);const g=async a=>{a.preventDefault(),j(!0);try{const c=t?`/v1/roles/${t.id}`:"/v1/roles",n=t?"put":"post",{data:m}=await y[n](c,i);m.success&&(x.success(t?"Rol actualizado exitosamente":"Rol creado exitosamente"),l==null||l(m.data,!!t),h())}catch(c){console.error("Error al guardar rol:",c),x.error("Error al guardar el rol")}finally{j(!1)}},v=(a,c)=>{p(n=>({...n,permissions:c?[...n.permissions,a]:n.permissions.filter(m=>m!==a)}))};return e.jsx(z,{open:u,onOpenChange:h,children:e.jsxs(A,{children:[e.jsxs(F,{children:[e.jsx(H,{children:t?"Editar Rol":"Crear Rol"}),e.jsx(O,{children:t?"Actualiza los datos del rol":"Ingresa los datos del nuevo rol"})]}),e.jsxs("form",{onSubmit:g,className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(b,{htmlFor:"name",children:"Nombre"}),e.jsx(w,{id:"name",value:i.name,onChange:a=>p({...i,name:a.target.value}),required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(b,{children:"Permisos"}),e.jsx("div",{className:"grid grid-cols-2 gap-2",children:N.map(a=>e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx($,{id:`permission-${a.value}`,checked:i.permissions.includes(a.value),onCheckedChange:c=>v(a.value,c)}),e.jsx(b,{htmlFor:`permission-${a.value}`,children:a.label})]},a.value))})]}),e.jsxs(T,{children:[e.jsx(d,{type:"button",variant:"outline",onClick:h,children:"Cancelar"}),e.jsx(d,{type:"submit",disabled:f,children:f?"Guardando...":t?"Actualizar":"Crear"})]})]})]})})}function Ke(){const[u,h]=o.useState([]),[t,N]=o.useState({current_page:1,from:0,last_page:1,links:[],path:"",per_page:10,to:0,total:0}),[l,i]=o.useState(Z),[p,f]=o.useState([]),[j,g]=o.useState(!1),[v,a]=o.useState(!1),[c,n]=o.useState(void 0),m=async()=>{try{g(!0);const{data:s}=await y.get("/v1/roles",{params:l});h(s.roles.data),N({current_page:s.roles.current_page,from:s.roles.from,last_page:s.roles.last_page,links:s.roles.links,path:s.roles.path,per_page:s.roles.per_page,to:s.roles.to,total:s.roles.total})}catch(s){console.error("Error al cargar roles:",s),x.error("Error al cargar los roles")}finally{g(!1)}},_=async()=>{try{const{data:s}=await y.get("/v1/roles/permissions");f(s.permissions.map(r=>({value:r.name,label:r.name.replace(/[._-]/g," ").replace(/\b\w/g,I=>I.toUpperCase())})))}catch(s){console.error("Error al cargar permisos:",s),x.error("Error al cargar los permisos")}};o.useEffect(()=>{m()},[l]),o.useEffect(()=>{_()},[]);const k=s=>{i(r=>({...r,search:s,page:1}))},S=s=>{i(r=>({...r,sort_field:s,sort_order:r.sort_field===s&&r.sort_order==="asc"?"desc":"asc",page:1}))},E=s=>{i(r=>({...r,page:s}))},R=s=>{n(s),a(!0)},D=async s=>{if(confirm("¿Está seguro de eliminar este rol?"))try{const{data:r}=await y.delete(`/v1/roles/${s.id}`);r.success&&(x.success("Rol eliminado exitosamente"),m())}catch(r){console.error("Error al eliminar rol:",r),x.error("Error al eliminar el rol")}},L=()=>{m(),a(!1),n(void 0)},P=[{title:"Roles",href:"/roles"}];return e.jsxs(U,{breadcrumbs:P,children:[e.jsx(M,{title:"Roles"}),e.jsxs("div",{className:"flex h-full flex-1 flex-col gap-4 overflow-x-auto rounded-xl p-4",children:[e.jsxs(B,{children:[e.jsxs(q,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Y,{className:"h-6 w-6"}),e.jsx("h2",{className:"text-2xl font-bold tracking-tight",children:"Roles"})]}),e.jsxs(d,{onClick:()=>a(!0),children:[e.jsx(C,{className:"mr-2 h-4 w-4"}),"Nuevo Rol"]})]}),e.jsxs(G,{children:[e.jsx("div",{className:"mb-6 flex flex-col gap-4 md:flex-row",children:e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"relative",children:[e.jsx(X,{className:"absolute top-2.5 left-2 h-4 w-4 text-muted-foreground"}),e.jsx(w,{placeholder:"Buscar roles...",value:l.search,onChange:s=>k(s.target.value),className:"pl-8"})]})})}),e.jsx("div",{className:"relative overflow-x-auto",children:j?e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx("div",{className:"h-8 w-8 animate-spin rounded-full border-b-2 border-primary"})}):u.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center gap-4 py-8",children:[e.jsx(J,{className:"h-12 w-12 text-muted-foreground"}),e.jsx("p",{className:"text-lg text-muted-foreground",children:l.search?"No se encontraron resultados":"No hay roles registrados"}),l.search?e.jsx(d,{variant:"outline",onClick:()=>i(s=>({...s,search:""})),children:"Limpiar filtros"}):e.jsxs(d,{onClick:()=>a(!0),children:[e.jsx(C,{className:"mr-2 h-4 w-4"}),"Crear nuevo rol"]})]}):e.jsxs("table",{className:"w-full text-left text-sm text-gray-500 dark:text-gray-400",children:[e.jsx("thead",{className:"bg-gray-50 text-xs text-gray-700 uppercase dark:bg-gray-700 dark:text-gray-400",children:e.jsxs("tr",{children:[e.jsxs("th",{scope:"col",className:"cursor-pointer px-6 py-3",onClick:()=>S("name"),children:["Nombre",l.sort_field==="name"&&e.jsx("span",{className:"ml-1",children:l.sort_order==="asc"?"↑":"↓"})]}),e.jsx("th",{scope:"col",className:"px-6 py-3",children:"Permisos"}),e.jsx("th",{scope:"col",className:"px-6 py-3",children:"Acciones"})]})}),e.jsx("tbody",{children:u.map(s=>e.jsxs("tr",{className:"border-b bg-white dark:border-gray-700 dark:bg-gray-800",children:[e.jsx("td",{className:"px-6 py-4 font-medium whitespace-nowrap text-gray-900 dark:text-white",children:s.name}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("div",{className:"flex flex-wrap gap-1",children:s.permissions.map(r=>e.jsx("span",{className:"rounded bg-primary/10 px-2 py-1 text-xs font-medium text-primary",children:r.name},r.name))})}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(d,{variant:"outline",size:"icon",onClick:()=>R(s),children:e.jsx(K,{className:"h-4 w-4"})}),e.jsx(d,{variant:"outline",size:"icon",onClick:()=>D(s),children:e.jsx(Q,{className:"h-4 w-4"})})]})})]},s.id))})]})}),t.last_page>1&&e.jsxs("div",{className:"mt-4 flex items-center justify-between",children:[e.jsxs("div",{className:"text-sm text-gray-700 dark:text-gray-400",children:["Mostrando ",e.jsx("span",{className:"font-medium",children:t.from})," a ",e.jsx("span",{className:"font-medium",children:t.to})," de"," ",e.jsx("span",{className:"font-medium",children:t.total})," resultados"]}),e.jsx("div",{className:"flex items-center space-x-2",children:t.links.map((s,r)=>e.jsx(d,{variant:s.active?"default":"outline",disabled:!s.url,onClick:()=>s.url&&E(r),children:e.jsx("span",{dangerouslySetInnerHTML:{__html:s.label}})},r))})]})]})]}),e.jsx(ee,{isOpen:v,onClose:()=>{a(!1),n(void 0)},role:c,permissions:p,onSuccess:L})]})]})}export{Ke as default};
